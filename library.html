<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Media Library</title>
<style>
body{font-family:sans-serif;margin:0;padding:1rem;}
#results{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:1rem;margin-top:1rem;}
.item{cursor:pointer;display:flex;flex-direction:column;align-items:center;}
.item img{width:160px;height:90px;object-fit:cover;border-radius:4px;background:#000;}
.item .caption{margin-top:4px;font-size:14px;text-align:center;word-break:break-word;}
#player{width:100%;max-height:60vh;margin-top:1rem;display:none;background:#000;}
</style>
</head>
<body>
<h1>Media Library</h1>
<div>
<input id="search" type="text" placeholder="Search..." />
<button id="searchBtn">Search</button>
<button id="clearBtn">Clear</button>
</div>
<div id="results"></div>
<video id="player" controls></video>
<script>
async function load(q=""){
  const res=await fetch('/api/library/media'+(q?`?q=${encodeURIComponent(q)}`:''));
  if(!res.ok) return;
  const data=await res.json();
  const list=data.data.files||[];
  const results=document.getElementById('results');
  results.innerHTML='';
  list.forEach(f=>{
    const div=document.createElement('div');
    div.className='item';
    const img=document.createElement('img');
    img.src='/api/cover/get?path='+encodeURIComponent(f.path);
    img.alt=f.path.split('/').pop();
    img.onerror=()=>{img.style.display='none';};
    div.appendChild(img);
    const cap=document.createElement('div');
    cap.className='caption';
    const name=f.path.split('/').pop();
    cap.textContent=f.metadata?.title||name;
    div.appendChild(cap);
    div.onclick=()=>{play(f);};
    results.appendChild(div);
  });
}
function play(file){
  const player=document.getElementById('player');
  player.src='/api/stream?path='+encodeURIComponent(file.path);
  player.style.display='block';
  player.play();
}
document.getElementById('searchBtn').onclick=()=>load(document.getElementById('search').value);
document.getElementById('clearBtn').onclick=()=>{document.getElementById('search').value='';load();};
document.getElementById('search').addEventListener('keypress',e=>{if(e.key==='Enter')load(e.target.value);});
load();
</script>
</body>
</html>
