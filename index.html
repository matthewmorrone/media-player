<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Media Library</title>
  <link rel="stylesheet" href="index.css" />
  <script src="index.js" defer></script>
</head>
<body>
  <header>
    <div class="header-top">
      <h1>Media Library</h1>
      <div id="folderBar">
        <input id="folderInput" type="text" placeholder="Type a folder (relative) to browse, or an absolute path to set root â€” Enter. Double-click to pick." title="Enter a relative folder within the library (e.g., Shows/Season 1), or an absolute path (e.g., /Volumes/Media or ~/Movies) to set the library root. Press Enter. Double-click to open the picker." />
      </div>
      <div id="controls">
        <button id="refresh" class="btn" title="Reload">Reload</button>
      </div>
    </div>
    
    <!-- Tab Navigation -->
    <nav class="tab-nav" role="tablist" aria-label="Main navigation">
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="player-panel" id="player-tab" data-tab="player">
        Player
      </button>
      <button class="tab-button active" role="tab" aria-selected="true" aria-controls="library-panel" id="library-tab" data-tab="library">
        Library
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="tasks-panel" id="tasks-tab" data-tab="tasks">
        Tasks
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="settings-panel" id="settings-tab" data-tab="settings">
        Settings
      </button>
    </nav>
  </header>
  
  <main>
    <!-- Tab Panels -->
    <div class="tab-panels">
      <!-- Player Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="player-tab" id="player-panel" hidden>
        <div id="playerLayout" style="display:flex; gap:12px; align-items:stretch; padding: 8px 0;">
          <!-- Sidebar -->
          <aside id="playerSidebar" style="width: 280px; min-width: 240px; max-width: 360px; background: #0f1320; border: 1px solid rgba(255,255,255,0.06); border-radius: 10px; padding: 12px; display:flex; flex-direction:column; gap:12px;">
            <div>
              <div id="sbFileName" style="font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">No file</div>
              <div id="sbMeta" style="color: var(--muted, #7a859f); font-size:12px;">â€”</div>
            </div>
            <div style="height:1px; background: rgba(255,255,255,0.06);"></div>
            <div style="display:flex; flex-direction:column; gap:10px;">
              <div style="font-weight:600;">Artifacts</div>
              <div id="artifactBadges" style="display:flex; flex-direction:column; gap:8px;">
                <button id="badgeHeatmap" class="btn-sm" title="Heatmap status or generate" data-present="0">Heatmap <span id="badgeHeatmapStatus" style="opacity:0.8; margin-left:6px;">âœ—</span></button>
                <button id="badgeScenes" class="btn-sm" title="Scenes status or generate" data-present="0">Scenes <span id="badgeScenesStatus" style="opacity:0.8; margin-left:6px;">âœ—</span></button>
                <button id="badgeSubtitles" class="btn-sm" title="Subtitles status or generate" data-present="0">Subtitles <span id="badgeSubtitlesStatus" style="opacity:0.8; margin-left:6px;">âœ—</span></button>
                <button id="badgeSprites" class="btn-sm" title="Sprites status or generate" data-present="0">Sprites <span id="badgeSpritesStatus" style="opacity:0.8; margin-left:6px;">âœ—</span></button>
                <button id="badgeFaces" class="btn-sm" title="Faces status or generate" data-present="0">Faces <span id="badgeFacesStatus" style="opacity:0.8; margin-left:6px;">âœ—</span></button>
                <button id="badgeHover" class="btn-sm" title="Hover preview status or generate" data-present="0">Hover Preview <span id="badgeHoverStatus" style="opacity:0.8; margin-left:6px;">âœ—</span></button>
                <button id="badgePhash" class="btn-sm" title="pHash status or generate" data-present="0">pHash <span id="badgePhashStatus" style="opacity:0.8; margin-left:6px;">âœ—</span></button>
              </div>
            </div>
          </aside>
          
          <!-- Main Player Area -->
          <div id="playerContainer" style="display:flex; flex-direction:column; gap:10px; padding: 0; flex:1;">
            <div class="player-header" style="display:flex; align-items:center; gap:12px; justify-content:space-between;">
              <div style="display:flex; flex-direction:column; gap:4px; min-width:0;">
                <div id="playerTitle" style="font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">No file</div>
                <div id="playerMeta" style="color: var(--muted, #7a859f); font-size:12px;">â€”</div>
              </div>
              <div class="player-actions" style="display:flex; gap:8px;">
                <button id="btnSetThumb" class="btn-sm" title="Set the cover thumbnail to current frame">Set Thumbnail</button>
                <button id="btnAddMarker" class="btn-sm" title="Add a scene marker at current time">Add Marker</button>
              </div>
            </div>
            <div class="player-video" style="position:relative; background:#000;">
              <video id="playerVideo" playsinline style="display:block; width:100%; max-height:72vh; background:#000;"></video>
            </div>
            <!-- Controls and timeline below video -->
            <div id="playerControlsContainer" style="position:relative; display:flex; flex-direction:column; gap:8px;">
              <div id="timeline" style="position:relative; height:28px; border-radius:6px; background: #121624; overflow:hidden; cursor:pointer; box-shadow:0 4px 14px rgba(0,0,0,0.35);">
                <div id="timelineHeatmap" style="position:absolute; inset:0; background-position: left center; background-size: 100% 100%; opacity:0.85;"></div>
                <canvas id="timelineHeatmapCanvas" style="position:absolute; inset:0; width:100%; height:100%; pointer-events:none; opacity:0.95;"></canvas>
                <div id="timelineProgress" style="position:absolute; inset:0; width:0%; background: linear-gradient(90deg, rgba(79,140,255,0.6), rgba(79,140,255,0.25)); mix-blend-mode: screen;"></div>
                <div id="timelineMarkers" style="position:absolute; inset:0;"></div>
              </div>
              <!-- Sprite preview tooltip (bottom-aligned above controls) -->
              <div id="spritePreview" style="position:absolute; left:8px; width:240px; height:135px; background:#111 center/cover no-repeat; border:1px solid rgba(255,255,255,0.15); border-radius:6px; display:none; pointer-events:none; box-shadow:0 4px 16px rgba(0,0,0,0.4); z-index:6; opacity:0.8;"></div>
              <div id="controlsRow" style="display:flex; align-items:center; justify-content:space-between; gap:8px; background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.12); border-radius: 10px; padding: 6px 10px;">
                <div style="font-size:12px; color: var(--muted, #7a859f); display:flex; align-items:center; gap:4px;">
                  <span id="curTime">00:00</span>
                  <span style="opacity:0.5;">/</span>
                  <span id="totalTime">00:00</span>
                </div>
                <div id="playerControls" class="player-controls" style="display:flex; align-items:center; gap:8px;">
                  <button id="btnPlayPause" class="btn-sm" title="Play/Pause" aria-label="Play/Pause">â–¶ï¸Ž</button>
                  <button id="btnMute" class="btn-sm" title="Mute/Unmute" aria-label="Mute">ðŸ”Š</button>
                  <input id="volSlider" type="range" min="0" max="1" step="0.01" value="1" title="Volume" style="width:120px;">
                  <button id="btnCC" class="btn-sm" title="Toggle captions" aria-label="Captions">CC</button>
                  <div class="select">
                    <select id="rateSelect" class="control-select" title="Playback speed" aria-label="Playback speed">
                      <option value="0.5">0.5Ã—</option>
                      <option value="0.75">0.75Ã—</option>
                      <option value="1" selected>1Ã—</option>
                      <option value="1.25">1.25Ã—</option>
                      <option value="1.5">1.5Ã—</option>
                      <option value="1.75">1.75Ã—</option>
                      <option value="2">2Ã—</option>
                    </select>
                    <span class="chevron">â–¾</span>
                  </div>
                  <button id="btnPip" class="btn-sm" title="Picture in Picture" aria-label="Picture in Picture">â§‰</button>
                  <button id="btnFullscreen" class="btn-sm" title="Fullscreen" aria-label="Fullscreen">â›¶</button>
                </div>
              </div>
            </div>
            <div class="player-timeline" style="display:none;"></div>
          </div>
        </div>
      </div>
      
      <!-- Library Tab Panel -->
      <div class="tab-panel active" role="tabpanel" aria-labelledby="library-tab" id="library-panel">
        <div class="controls-panel">
          <div class="controls-row">
            <div class="control-group">
              <!-- <span class="control-label">Search</span> -->
              <input id="searchInput" type="text" class="control-input" placeholder="Search files..." />
            </div>
            <div class="control-group">
              <div class="select">
                <select id="resSelect" class="control-select" title="Filter by resolution">
                  <option value="" selected>All resolutions</option>
                  <option value="2160">2160p+</option>
                  <option value="1440">1440p+</option>
                  <option value="1080">1080p+</option>
                  <option value="720">720p+</option>
                  <option value="480">480p+</option>
                </select>
                <span class="chevron">â–¾</span>
              </div>
            </div>
            <div class="control-group">
              <!-- <span class="control-label">Sort</span> -->
              <div class="select">
                <select id="sortSelect" class="control-select">
                  <option value="date">Date</option>
                  <option value="name">Name</option>
                  <option value="size">Size</option>
                  <option value="random">Random</option>
                </select>
                <span class="chevron">â–¾</span>
              </div>
              <button id="orderToggle" class="btn-sm order-btn" data-order="desc" title="Toggle sort order">â–¼</button>
            </div>
            <div class="pagination-group">
              <div class="control-group">
                <!-- <span class="control-label">Density</span> -->
                <input id="densitySlider" type="range" min="1" max="15" value="12" step="1" class="control-slider" title="Adjust grid density (columns)" />
              </div>
              <div class="pagination">
                <button id="prevBtn" class="btn-sm" title="Previous page">â€¹</button>
                <span id="pageInfo" class="page-info">Page 1 of 1</span>
                <button id="nextBtn" class="btn-sm" title="Next page">â€º</button>
              </div>
            </div>
          </div>
        </div>
        <div id="selectionBar" class="selection-bar" hidden>
          <span id="selectionCount" class="selection-count">0 selected</span>
          <button id="selectAllBtn" class="btn-sm">Select All</button>
          <button id="selectNoneBtn" class="btn-sm">Select None</button>
        </div>
        
        <div id="spinner" class="spinner"></div>
        <div id="status"></div>

        <!-- Card template (hidden) -->
        <template id="cardTemplate">
          <div class="card">
            <div class="card-checkbox"></div>
            <div class="thumb-wrap">
              <div class="quality-badge" aria-hidden="true"></div>
              <img class="thumb" loading="lazy" />
              <!-- Overlay info (resolution only) -->
              <div class="overlay-info" aria-hidden="true">
                <span class="overlay-resolution"></span>
              </div>
            </div>
            <div class="meta">
              <p class="title"></p>
              <div class="row sub">
                <span class="duration"></span>
                <span class="size"></span>
              </div>
            </div>
          </div>
        </template>
        
        <!-- Directory card template (hidden) -->
        <template id="dirTemplate">
          <div class="card">
            <div class="thumb dir-thumb">
              <div class="dir-thumb-inner">
                <span class="dir-icon"></span>
                <span class="dir-name"></span>
              </div>
            </div>
            <div class="meta">
              <p class="title"></p>
              <div class="row sub"><span>Folder</span><span></span></div>
            </div>
          </div>
        </template>
        
        <div id="grid" class="grid" hidden></div>
      </div>
      
      <!-- Tasks Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="tasks-tab" id="tasks-panel" hidden>
        <div class="tasks-container">
          
          <!-- Job Monitor Section -->
          <div class="task-section">
            <div class="section-header">
          <h2>Job Monitor</h2>
          <div class="section-actions">
            <button id="cancelAllBtn" class="btn-sm" title="Cancel all queued and running jobs" style="display:none;">Cancel All</button>
            <button id="cancelQueuedBtn" class="btn-sm" title="Cancel all queued jobs" style="display:none;">Cancel Queued</button>
            <button id="clearCompletedBtn" class="btn-sm" title="Remove completed jobs from the list" style="display:none;">Clear Completed</button>
          </div>
            </div>
            
            <div class="job-stats">
              <div class="stat-card" id="filterQueued" data-filter="queued" title="Show only queued jobs">
                <span class="stat-label">Queued</span>
                <span class="stat-value" id="queuedJobsCount">0</span>
              </div>
              <div class="stat-card" id="filterActive" data-filter="running" title="Show only active (running) jobs">
                <span class="stat-label">Active</span>
                <span class="stat-value" id="activeJobsCount">0</span>
              </div>
              <div class="stat-card" id="filterCompleted" data-filter="completed" title="Show completed jobs">
                <span class="stat-label">Completed</span>
                <span class="stat-value" id="completedJobsCount">0</span>
              </div>
              <div class="stat-card" id="filterErrored" data-filter="failed" title="Show failed jobs">
                <span class="stat-label">Errored</span>
                <span class="stat-value" id="failedJobsCount">0</span>
              </div>
            </div>
            
            <div class="job-table-container" id="jobTableContainer">
              <table class="job-table">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Task</th>
                    <th>File</th>
                    <th>Status</th>
                    <th>Progress</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="jobTableBody">
                  <!-- Jobs will be populated here -->
                </tbody>
              </table>
              <div class="resize-handle" id="jobResizeHandle" title="Drag to resize"></div>
            </div>
          </div>

          <!-- Artifact Generation Section -->
          <div class="task-section">
            <div class="section-header">
              <h2>Generate Artifacts</h2>
            </div>

            <!-- File Selection -->
            <div class="file-selection">
              <div class="selection-options">
                <label class="selection-option">
                  <input type="radio" name="fileSelection" value="all" checked>
                  All files in library
                </label>
                <label class="selection-option">
                  <input type="radio" name="fileSelection" value="selected">
                  Selected files (<span id="selectedFileCount">0</span>)
                </label>
                <button id="generateAllBtn" class="btn-sm" title="Queue all missing artifacts for the chosen scope" style="margin-left:auto;">Generate All</button>
              </div>
            </div>

            <!-- Artifact Types -->
            <div class="artifact-grid">
              
              <div class="artifact-card" data-artifact="metadata">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Metadata</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="metadataCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="metadataFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate" data-operation="metadata-missing">Generate Missing</button>
                    <button class="btn-recompute" data-operation="metadata-all" style="display:none;">Recompute All</button>
                  </div>
                </div>
              </div>

              <div class="artifact-card" data-artifact="thumbnails">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Thumbnails</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="thumbnailsCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="thumbnailsFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate" data-operation="thumbnails-missing" title="Generate missing thumbnails">
                      Generate Missing
                    </button>
                    <button class="btn-recompute" data-operation="thumbnails-all" title="Recompute all thumbnails" style="display:none;">
                      Recompute All
                    </button>
                    <button class="btn-options" data-artifact="thumbnails" title="Options">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip" id="thumbnailsOptions" style="display:none;">
                  <label>Offset (seconds): <input type="number" id="thumbnailOffset" value="10" min="1" max="3600"></label>
                </div>
              </div>

              <div class="artifact-card" data-artifact="sprites">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Sprite Sheets</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="spritesCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="spritesFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate" data-operation="sprites-missing">Generate Missing</button>
                    <button class="btn-recompute" data-operation="sprites-all" style="display:none;">Recompute All</button>
                    <button class="btn-options" data-artifact="sprites">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip" id="spritesOptions" style="display:none;">
                  <label>Interval (sec): <input type="number" id="spriteInterval" value="10" min="1" max="60"></label>
                  <label>Width (px): <input type="number" id="spriteWidth" value="320" min="160" max="1920"></label>
                  <label>Columns: <input type="number" id="spriteCols" value="10" min="5" max="20"></label>
                </div>
              </div>

              <div class="artifact-card" data-artifact="previews">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Hover Previews</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="previewsCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="previewsFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate" data-operation="previews-missing">Generate Missing</button>
                    <button class="btn-recompute" data-operation="previews-all" style="display:none;">Recompute All</button>
                    <button class="btn-options" data-artifact="previews">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip" id="previewsOptions" style="display:none;">
                  <label>Segments: <input type="number" id="previewSegments" value="9" min="5" max="20"></label>
                  <label>Duration (sec): <input type="number" id="previewDuration" value="1.0" min="0.5" max="3.0" step="0.1"></label>
                </div>
              </div>

              <div class="artifact-card" data-artifact="phash">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Perceptual Hash</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="phashCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="phashFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate" data-operation="phash-missing">Generate Missing</button>
                    <button class="btn-recompute" data-operation="phash-all" style="display:none;">Recompute All</button>
                    <button class="btn-options" data-artifact="phash">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip" id="phashOptions" style="display:none;">
                  <label>Frames: <input type="number" id="phashFrames" value="5" min="3" max="10"></label>
                  <label>Algorithm: 
                    <div class="select">
                      <select id="phashAlgo" class="control-select">
                        <option value="ahash">Average Hash</option>
                        <option value="phash">Perceptual Hash</option>
                        <option value="dhash">Difference Hash</option>
                      </select>
                      <span class="chevron">â–¾</span>
                    </div>
                  </label>
                </div>
              </div>

              <div class="artifact-card" data-artifact="scenes">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Scene Detection</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="scenesCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="scenesFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate" data-operation="scenes-missing">Generate Missing</button>
                    <button class="btn-recompute" data-operation="scenes-all" style="display:none;">Recompute All</button>
                    <button class="btn-options" data-artifact="scenes">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip" id="scenesOptions" style="display:none;">
                  <label>Threshold: <input type="number" id="sceneThreshold" value="0.4" min="0.1" max="1.0" step="0.1"></label>
                  <label>Limit: <input type="number" id="sceneLimit" value="0" min="0" max="100"></label>
                </div>
              </div>

              <div class="artifact-card" data-artifact="heatmaps">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Heatmaps</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="heatmapsCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="heatmapsFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate" data-operation="heatmaps-missing">Generate Missing</button>
                    <button class="btn-recompute" data-operation="heatmaps-all" style="display:none;">Recompute All</button>
                    <button class="btn-preview" id="previewHeatmapsBtn" title="Preview a sample heatmap PNG">Preview</button>
                    <button class="btn-options" data-artifact="heatmaps">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip" id="heatmapsOptions" style="display:none;">
                  <label>Interval (sec): <input type="number" id="heatmapInterval" value="1.0" min="0.5" max="10.0" step="0.5"></label>
                  <label>Mode: 
                    <div class="select">
                      <select id="heatmapMode" class="control-select">
                        <option value="brightness">Brightness</option>
                        <option value="motion">Motion</option>
                        <option value="color">Color</option>
                      </select>
                      <span class="chevron">â–¾</span>
                    </div>
                  </label>
                </div>
              </div>

              <div class="artifact-card" data-artifact="subtitles">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Subtitles</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="subtitlesCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="subtitlesFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate" data-operation="subtitles-missing">Generate Missing</button>
                    <button class="btn-recompute" data-operation="subtitles-all" style="display:none;">Recompute All</button>
                    <button class="btn-options" data-artifact="subtitles">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip" id="subtitlesOptions" style="display:none;">
                  <label>Model: 
                    <div class="select">
                      <select id="subtitleModel" class="control-select">
                        <option value="tiny">Tiny</option>
                        <option value="base">Base</option>
                        <option value="small" selected>Small</option>
                        <option value="medium">Medium</option>
                        <option value="large">Large</option>
                      </select>
                      <span class="chevron">â–¾</span>
                    </div>
                  </label>
                  <label>Language: <input type="text" id="subtitleLang" placeholder="auto" maxlength="5"></label>
                </div>
              </div>

              <div class="artifact-card" data-artifact="faces">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Face Detection</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="facesCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="facesFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate" data-operation="faces-missing">Generate Missing</button>
                    <button class="btn-recompute" data-operation="faces-all" style="display:none;">Recompute All</button>
                    <button class="btn-options" data-artifact="faces">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip" id="facesOptions" style="display:none;">
                  <label>Interval (sec): <input type="number" id="faceInterval" value="1.0" min="0.5" max="10.0" step="0.5"></label>
                  <label>Min Size: <input type="number" id="faceMinSize" value="0.10" min="0.05" max="0.5" step="0.05"></label>
                  <label>Backend:
                    <div class="select">
                      <select id="faceBackend" class="control-select">
                        <option value="auto" selected>Auto</option>
                        <option value="opencv">OpenCV</option>
                        <option value="insightface">InsightFace</option>
                      </select>
                      <span class="chevron">â–¾</span>
                    </div>
                  </label>
                  <label>Scale Factor: <input type="number" id="faceScale" value="1.1" min="1.01" max="2.0" step="0.01"></label>
                  <label>Min Neighbors: <input type="number" id="faceMinNeighbors" value="5" min="0" max="20" step="1"></label>
                  <label>Similarity Thresh: <input type="number" id="faceSimThresh" value="0.9" min="0.1" max="1.0" step="0.05"></label>
                </div>
              </div>

              <!-- Embeddings (recompute embeddings without re-detecting boxes) -->
              <div class="artifact-card" data-artifact="embed">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Embeddings</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="embedCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="embedFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate" data-operation="embed-missing">Generate Missing</button>
                    <button class="btn-recompute" data-operation="embed-all" style="display:none;">Recompute All</button>
                    <button class="btn-options" data-artifact="embed" title="Options">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip" id="embedOptions" style="display:none;">
                  <label>Interval (sec): <input type="number" id="embedInterval" value="1.0" min="0.5" max="10.0" step="0.5"></label>
                  <label>Min Size: <input type="number" id="embedMinSize" value="0.10" min="0.05" max="0.5" step="0.05"></label>
                  <label>Backend:
                    <div class="select">
                      <select id="embedBackend" class="control-select">
                        <option value="auto" selected>Auto</option>
                        <option value="opencv">OpenCV</option>
                        <option value="insightface">InsightFace</option>
                      </select>
                      <span class="chevron">â–¾</span>
                    </div>
                  </label>
                  <label>Similarity Thresh: <input type="number" id="embedSimThresh" value="0.9" min="0.1" max="1.0" step="0.05"></label>
                </div>
              </div>

            </div>
          </div>

          <!-- Orphaned Artifacts Section -->
          <div class="task-section">
            <div class="section-header">
              <h2>Orphaned Artifacts</h2>
            </div>
            
            <div class="orphan-card">
              <div class="orphan-header">
                <div class="orphan-info">
                  <h3>Orphaned Files</h3>
                  <div class="orphan-stats">
                    <span class="orphan-count" id="orphanCount">0</span>
                    <span class="orphan-label">files without corresponding videos</span>
                  </div>
                </div>
                <div class="orphan-actions">
                  <button class="btn-cleanup" id="cleanupOrphansBtn" disabled>Clean Up</button>
                  <button class="btn-preview" id="previewOrphansBtn" disabled>Preview</button>
                </div>
              </div>
              <div class="orphan-details" id="orphanDetails" style="display:none;">
                <div class="orphan-list" id="orphanList">
                  <!-- Orphan files will be listed here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Settings Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="settings-tab" id="settings-panel" hidden>
        <div class="tab-content">
          <h2>Settings</h2>
          <div class="task-section" style="margin-top: 12px;">
            <div class="section-header">
              <h2>Player Preferences</h2>
            </div>
            <div class="file-selection" style="padding: 12px 0;">
              <label class="selection-option" style="gap: 10px; align-items: flex-start;">
                <input type="checkbox" id="settingAutoplayResume" />
                <div>
                  <div style="font-weight:600; display:flex; align-items:center; gap:8px;">
                    Autoplay on load when previously playing
                    <!-- reference subtitle icon placeholder (from user image) -->
                    <span aria-hidden="true" title="Subtitle icon reference" style="display:inline-block; width:16px; height:12px; border-radius:3px; background:#2c323d; position:relative; overflow:hidden;">
                      <span style="position:absolute; left:2px; right:2px; top:3px; height:3px; background:#12161f; border-radius:2px;"></span>
                      <span style="position:absolute; left:6px; right:2px; bottom:3px; height:3px; background:#12161f; border-radius:2px;"></span>
                    </span>
                  </div>
                  <div style="color: var(--muted); font-size: 12px; line-height:1.4;">
                    If enabled, the player resumes playback automatically when a video was playing before closing. Default is off.
                  </div>
                </div>
              </label>

              <label class="selection-option" style="gap: 10px; align-items: flex-start; margin-top: 12px;">
                <input type="checkbox" id="settingShowHeatmap" />
                <div>
                  <div style="font-weight:600;">Show timeline heatmap</div>
                  <div style="color: var(--muted); font-size: 12px; line-height:1.4;">
                    Toggle the heatmap overlay on the player timeline. This only affects display; artifacts and badges still load as usual.
                  </div>
                </div>
              </label>

              <label class="selection-option" style="gap: 10px; align-items: flex-start; margin-top: 12px;">
                <input type="checkbox" id="settingShowScenes" />
                <div>
                  <div style="font-weight:600;">Show scene boundary markers</div>
                  <div style="color: var(--muted); font-size: 12px; line-height:1.4;">
                    Toggle the scene boundary ticks on the player timeline. This only affects display; scenes data still loads as usual.
                  </div>
                </div>
              </label>
            </div>
          </div>
          <div class="task-section" style="margin-top: 12px;">
            <div class="section-header">
              <h2>Library Preferences</h2>
            </div>
            <div class="file-selection" style="padding: 12px 0;">
              <label class="selection-option" style="gap: 10px; align-items: flex-start;">
                <input type="checkbox" id="settingHoverPreviews" />
                <div>
                  <div style="font-weight:600;">Enable hover video previews</div>
                  <div style="color: var(--muted); font-size: 12px; line-height:1.4;">
                    When enabled, cards will play a small preview on hover. Previews are only played if they already exist; no background generation is triggered automatically.
                  </div>
                </div>
              </label>
              <label class="selection-option" style="gap: 10px; align-items: flex-start; margin-top: 12px;">
                <input type="checkbox" id="settingHoverOnDemand" />
                <div>
                  <div style="font-weight:600;">Generate hover previews on demand</div>
                  <div style="color: var(--muted); font-size: 12px; line-height:1.4;">
                    When enabled, hovering a card will request the server to create a preview if one doesnâ€™t exist yet. This may start background work and use CPU.
                  </div>
                </div>
              </label>
            </div>
          </div>
          <div class="task-section" style="margin-top: 12px;">
            <div class="section-header">
              <h2>Job Processing</h2>
            </div>
            <div class="file-selection" style="padding: 12px 0; display:flex; align-items:center; justify-content: space-between; gap:16px;">
              <div style="display:flex; align-items:center; gap:16px; width:100%;">
                <div style="font-weight:600;">Max concurrent jobs</div>
                <input type="number" id="settingConcurrency" min="1" max="16" step="1" value="4" style="width:120px;" />
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </main>
  
  
</body>
</html>
