<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Media Library</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
  <link rel="manifest" href="/static/manifest.json" />
  <link rel="stylesheet" href="index.css" />
  <!-- Cytoscape.js and plugins (for Performers Graph tab) -->
  <link rel="stylesheet" href="https://unpkg.com/cytoscape-panzoom@2.5.3/cytoscape.js-panzoom.css" />
  <script src="https://unpkg.com/cytoscape@3.27.0/dist/cytoscape.min.js"></script>
  <!-- fcose dependencies (must be loaded before fcose) -->
  <script src="https://unpkg.com/layout-base@2.0.1/layout-base.js"></script>
  <script src="https://unpkg.com/cose-base@2.2.0/cose-base.js"></script>
  <script src="https://unpkg.com/cytoscape-fcose@2.2.0/cytoscape-fcose.js"></script>
  <script src="https://unpkg.com/cytoscape-cxtmenu@3.5.0/cytoscape-cxtmenu.js"></script>
  <script src="https://unpkg.com/cytoscape-panzoom@2.5.3/cytoscape-panzoom.js"></script>
  <script>
    // Apply collapsed class ASAP to avoid post-load reflow when sidebar is persisted collapsed
    try {
      if (localStorage.getItem('mediaPlayer:sidebarCollapsed') === '1') {
        (document.documentElement || document.body).classList.add('has-sidebar-collapsed');
      }
    } catch (e) { }
  </script>
  <script>window.__JOBS_SSE_ENABLED = false; /* detected by client via /api/config; default false to avoid assumptions */</script>
  <script>
    // Fire TV/Android TV Detection
    (function() {
      const isFireTV = /silk|aftvb|afts|aft\w|aftt/i.test(navigator.userAgent);
      const isAndroidTV = /android.*tv|googletv/i.test(navigator.userAgent);

      if (isFireTV || isAndroidTV) {
        document.documentElement.classList.add('firetv');
        // Also add to <body> once DOM is ready so body-scoped rules can apply
        const addBodyClass = () => {
          try {
            document.body.classList.add('firetv');
          }
          catch (_) {}
        };
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', addBodyClass, { once: true });
        }
        else {
          addBodyClass();
        }
      }
    })();
  </script>
  <script type="module" src="index.js"></script>
  <style>
    /* Column filter trigger and popover (List tab) */
    .col-filter-trigger { margin-left: 6px; font-size: 12px; opacity: .7; cursor: pointer; }
    .col-filter-trigger:hover { opacity: 1; }
    .list-filter-menu { position: absolute; z-index: 9999; background: var(--panel-bg, #111827); color: inherit; border: 1px solid rgba(255,255,255,0.08); border-radius: 6px; padding: 10px; box-shadow: 0 6px 18px rgba(0,0,0,.35); min-width: 220px; }
    .list-filter-menu .row { display: flex; align-items: center; gap: 8px; margin: 6px 0; }
    .list-filter-menu .values { padding: 4px 0; }
    .list-filter-menu .values label { display: flex; align-items: center; justify-content: space-between; gap: 6px; padding: 2px 4px; font-size: 12px; }
    .list-filter-menu .values label span { color: var(--muted); }
    .list-filter-menu .footer { display: flex; justify-content: flex-end; gap: 8px; margin-top: 8px; }
    .list-filter-menu select.control-select { height: 26px; font-size: 12px; padding: 0 18px 0 8px; }
    .list-table tbody td.col-artifacts .chips-list { display: flex; flex-wrap: wrap; gap: 6px; }
    .list-table tbody td.col-artifacts .chip { font-size: 11px; padding: 2px 6px; border-radius: 12px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.14); }
    .list-table tbody td.col-artifacts .chip--ok { background: rgba(34,197,94,0.12); border-color: rgba(34,197,94,0.4); color: #bbf7d0; }
    .list-table tbody td.col-artifacts .chip--missing { background: rgba(239,68,68,0.12); border-color: rgba(239,68,68,0.45); color: #fecaca; }
  </style>
</head>

<body>
  <!-- Inline SVG sprite (all icon symbols embedded; external icons.svg removed) -->
  <svg aria-hidden="true" focusable="false" class="svg-sprite">
    <symbol id="icon-placeholder" viewBox="0 0 320 180">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#0e1016" />
          <stop offset="100%" stop-color="#1a2030" />
        </linearGradient>
      </defs>
      <rect width="320" height="180" fill="url(#g)" />
      <g fill="#3b4663">
        <rect x="30" y="40" width="260" height="100" rx="8" />
        <polygon points="140,90 140,70 200,90 140,110" fill="#6b7aa6" />
      </g>
    </symbol>
    <symbol id="icon-play" viewBox="0 0 24 24">
      <!-- Triangular play icon with slight inset for sharper edges -->
      <path d="M7 5v14l11-7-11-7z" fill="currentColor" />
    </symbol>
    <symbol id="icon-pause" viewBox="0 0 24 24">
      <path d="M7 5h4v14H7zM13 5h4v14h-4z" fill="currentColor" />
    </symbol>
    <symbol id="icon-vol" viewBox="0 0 24 24">
      <path d="M3 9v6h4l5 4V5L7 9H3z" fill="currentColor" />
      <!-- Sound waves (shown only in unmuted icon) -->
      <path d="M14 9.5c.9.6 1.5 1.5 1.5 2.5s-.6 1.9-1.5 2.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" fill="none" />
      <path d="M16.5 7.5c1.4 1 2.5 2.6 2.5 4.5s-1.1 3.5-2.5 4.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" fill="none" />
    </symbol>
    <symbol id="icon-muted" viewBox="0 0 24 24">
      <path d="M3 9v6h4l5 4V5L7 9H3z" fill="currentColor" />
      <path d="M16 8l4 8M20 8l-4 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-options" viewBox="0 0 24 24">
      <circle cx="5" cy="12" r="2" fill="currentColor" />
      <circle cx="12" cy="12" r="2" fill="currentColor" />
      <circle cx="19" cy="12" r="2" fill="currentColor" />
    </symbol>
    <symbol id="icon-gear" viewBox="0 0 24 24">
      <!-- Simplified cog with 6 teeth for clarity at small sizes -->
      <circle cx="12" cy="12" r="3.25" fill="currentColor" />
      <path d="M12 2.75l1.2.45a2 2 0 0 0 2.6-1.2l.3-.8 2.2 1.27-.3.8a2 2 0 0 0 1.2 2.6l.8.3v2.54l-.8.3a2 2 0 0 0-1.2 2.6l.3.8-2.2 1.27-.3-.8a2 2 0 0 0-2.6-1.2l-1.2.45-1.2-.45a2 2 0 0 0-2.6 1.2l-.3.8-2.2-1.27.3-.8a2 2 0 0 0-1.2-2.6l-.8-.3V8.37l.8-.3a2 2 0 0 0 1.2-2.6l-.3-.8L7.9 3.2l.3.8A2 2 0 0 0 10.8 5l1.2-.45z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" opacity="0.9" />
    </symbol>
    <symbol id="icon-caret" viewBox="0 0 24 24">
      <!-- filled chevron for better visibility (uses currentColor) -->
      <path d="M9 18 L15 12 L9 6 Z" fill="currentColor" />
    </symbol>
    <symbol id="icon-jump" viewBox="0 0 24 24">
      <path d="M4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0zm5.5-3.5v7l6-3.5-6-3.5z" fill="currentColor" />
    </symbol>
    <symbol id="icon-clear" viewBox="0 0 24 24">
      <path d="M12 10.586 7.757 6.343 6.343 7.757 10.586 12l-4.243 4.243 1.414 1.414L12 13.414l4.243 4.243 1.414-1.414L13.414 12l4.243-4.243-1.414-1.414L12 10.586z" fill="currentColor" />
    </symbol>
    <symbol id="icon-reset" viewBox="0 0 24 24">
      <!-- Circular arrow reset icon -->
      <path d="M12 5a7 7 0 1 1-6.23 4H8a1 1 0 0 0 0-2H4.5A1.5 1.5 0 0 0 3 8.5V13a1 1 0 0 0 2 0V9.97A9 9 0 1 0 12 3v2z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" />
    </symbol>
    <symbol id="icon-restart" viewBox="0 0 24 24">
      <!-- Replay arrow for restarting current video -->
      <path d="M12 5V2L7 7l5 5V9c3.31 0 6 2.69 6 6s-2.69 6-6 6a6 6 0 0 1-5.65-4H6.1A8 8 0 0 0 20 15c0-4.42-3.58-8-8-8z" fill="currentColor" />
    </symbol>
    <symbol id="icon-prev" viewBox="0 0 24 24">
      <path d="M18 5v14l-8-7 8-7z" fill="currentColor" />
      <path d="M6 5h2v14H6z" fill="currentColor" />
    </symbol>
    <symbol id="icon-next" viewBox="0 0 24 24">
      <path d="M6 5v14l8-7-8-7z" fill="currentColor" />
      <path d="M16 5h2v14h-2z" fill="currentColor" />
    </symbol>
    <!-- Shuffle / Random icon (path supplied by user) -->
    <symbol id="icon-shuffle" viewBox="0 0 1792 1792">
      <path fill="currentColor" d="M666 481q-60 92-137 273-22-45-37-72.5t-40.5-63.5-51-56.5-63-35-81.5-14.5h-224q-14 0-23-9t-9-23v-192q0-14 9-23t23-9h224q250 0 410 225zm1126 799q0 14-9 23l-320 320q-9 9-23 9-13 0-22.5-9.5t-9.5-22.5v-192q-32 0-85 .5t-81 1-73-1-71-5-64-10.5-63-18.5-58-28.5-59-40-55-53.5-56-69.5q59-93 136-273 22 45 37 72.5t40.5 63.5 51 56.5 63 35 81.5 14.5h256v-192q0-14 9-23t23-9q12 0 24 10l319 319q9 9 9 23zm0-896q0 14-9 23l-320 320q-9 9-23 9-13 0-22.5-9.5t-9.5-22.5v-192h-256q-48 0-87 15t-69 45-51 61.5-45 77.5q-32 62-78 171-29 66-49.5 111t-54 105-64 100-74 83-90 68.5-106.5 42-128 16.5h-224q-14 0-23-9t-9-23v-192q0-14 9-23t23-9h224q48 0 87-15t69-45 51-61.5 45-77.5q32-62 78-171 29-66 49.5-111t54-105 64-100 74-83 90-68.5 106.5-42 128-16.5h256v-192q0-14 9-23t23-9q12 0 24 10l319 319q9 9 9 23z"/>
    </symbol>
    <!-- Repeat / Auto icon (two arrows in a circle) -->
    <symbol id="icon-repeat" viewBox="0 0 24 24">
      <path d="M7 7h7a5 5 0 0 1 0 10H7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M7 7l2.5-2.5M7 7L4.5 4.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M17 17H10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M17 17l-2.5 2.5M17 17l2.5 2.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
    <!-- Auto/loop icon for Random Auto (infinity-like circles) -->
    <symbol id="icon-auto-shuffle" viewBox="0 0 24 24">
      <path fill="currentColor" d="M20.288 9.463a4.856 4.856 0 0 0-4.336-2.3 4.586 4.586 0 0 0-3.343 1.767c.071.116.148.226.212.347l.879 1.652.134-.254a2.71 2.71 0 0 1 2.206-1.519 2.845 2.845 0 1 1 0 5.686 2.708 2.708 0 0 1-2.205-1.518L13.131 12l-1.193-2.26a4.709 4.709 0 0 0-3.89-2.581 4.845 4.845 0 1 0 0 9.682 4.586 4.586 0 0 0 3.343-1.767c-.071-.116-.148-.226-.212-.347l-.879-1.656-.134.254a2.71 2.71 0 0 1-2.206 1.519 2.855 2.855 0 0 1-2.559-1.369 2.825 2.825 0 0 1 0-2.946 2.862 2.862 0 0 1 2.442-1.374h.121a2.708 2.708 0 0 1 2.205 1.518l.7 1.327 1.193 2.26a4.709 4.709 0 0 0 3.89 2.581h.209a4.846 4.846 0 0 0 4.127-7.378z"/>
    </symbol>
    <symbol id="icon-cc" viewBox="0 0 24 24">
      <rect x="2" y="5" width="20" height="14" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2" />
      <path d="M11.2 14.5c-.43.3-.93.5-1.5.5a3 3 0 1 1 0-6c.57 0 1.07.2 1.5.5M17.2 14.5c-.43.3-.93.5-1.5.5a3 3 0 1 1 0-6c.57 0 1.07.2 1.5.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
    </symbol>
    <!-- Rating and Favorite Icons -->
    <symbol id="icon-star" viewBox="0 0 24 24">
      <path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.46 4.73L5.82 21z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round" />
    </symbol>
    <symbol id="icon-star-filled" viewBox="0 0 24 24">
      <path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.46 4.73L5.82 21z" fill="currentColor" />
    </symbol>
    <symbol id="icon-heart" viewBox="0 0 24 24">
      <path d="M12.1 8.64 12 8.77l-.1-.13C10.14 6.6 7.1 6.52 5.14 8.5 3.07 10.57 3.24 14 6 16.5c1.54 1.38 3.4 2.74 5.1 3.94 1.7-1.2 3.56-2.56 5.1-3.94 2.76-2.5 2.93-5.93.86-8C16.9 6.52 13.86 6.6 12.1 8.64z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round" />
    </symbol>
    <symbol id="icon-heart-filled" viewBox="0 0 24 24">
      <path d="M12.1 8.64 12 8.77l-.1-.13C10.14 6.6 7.1 6.52 5.14 8.5 3.07 10.57 3.24 14 6 16.5c1.54 1.38 3.4 2.74 5.1 3.94 1.7-1.2 3.56-2.56 5.1-3.94 2.76-2.5 2.93-5.93.86-8C16.9 6.52 13.86 6.6 12.1 8.64z" fill="currentColor" />
    </symbol>
    <!-- Camera icon for frame download -->
    <symbol id="icon-camera" viewBox="0 0 24 24">
      <path d="M4 7h3.2l1.6-2h6.4l1.6 2H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
      <circle cx="12" cy="13" r="4" fill="none" stroke="currentColor" stroke-width="2" />
      <circle cx="18" cy="9" r="1" fill="currentColor" />
    </symbol>
  </svg>

  <!-- Hidden SVG filters for video color matrix (kept with SVG definitions) -->
  <svg width="0" height="0" class="sprite-defs-hidden" aria-hidden="true" focusable="false">
    <filter id="playerColorMatrix" color-interpolation-filters="sRGB">
      <feColorMatrix id="playerColorMatrixValues" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0" />
    </filter>
  </svg>

  <!-- Templates: Settings JSON panels (Health, Config) -->
  <template id="settingsHealthTemplate">
    <section class="settings-block">
      <header class="flex-row gap-10">
        <strong>Server Health</strong>
        <div class="ml-auto"></div>
        <button class="btn-sm health-refresh" title="Refresh health">Refresh</button>
      </header>
      <pre class="json-pre health-pre" aria-live="polite"></pre>
    </section>
  </template>
  <template id="settingsConfigTemplate">
    <section class="settings-block">
      <header class="flex-row gap-10">
        <strong>Server Config</strong>
        <div class="ml-auto"></div>
        <button class="btn-sm config-refresh" title="Refresh config">Refresh</button>
      </header>
      <pre class="json-pre config-pre" aria-live="polite"></pre>
    </section>
  </template>

  <!-- Templates: Performers (card + empty state) -->
  <template id="performerCardTemplate">
    <div class="perf-card perf-card--pretty" role="group">
      <div class="card-checkbox" role="checkbox" aria-checked="false" aria-label="Select performer"></div>
      <div class="pc-top">
        <div class="pc-avatar" role="button" tabindex="0" aria-label="Upload image">
          <img class="pc-avatar-img" alt="" loading="lazy" hidden />
          <svg class="pc-avatar-icon" width="18" height="18" aria-hidden="true"><use href="#icon-camera"></use></svg>
        </div>
        <div class="pc-titlebox">
          <h3 class="pc-name"></h3>
          <div class="pc-metadata hint-sm"></div>
        </div>
        <div class="pc-countwrap">
          <div class="pc-count" title="Files">0</div>
          <span class="pc-face-indicator" aria-hidden="true"></span>
        </div>
      </div>
    </div>
  </template>
  <!-- Templates: Tags (card) -->
  <template id="tagCardTemplate">
    <div class="perf-card perf-card--pretty" role="group">
      <div class="card-checkbox" role="checkbox" aria-checked="false" aria-label="Select tag"></div>
      <div class="pc-top">
        <div class="pc-avatar" aria-hidden="true"></div>
        <div class="pc-titlebox">
          <h3 class="pc-name"></h3>
          <button class="tag-open-library-btn" type="button">Show in Library</button>
        </div>
        <span class="pc-count" title=""></span>
      </div>
    </div>
  </template>
  <template id="emptyHintTemplate">
    <div class="hint-sm empty-hint"></div>
  </template>

  <!-- Performer Import Preview Modal (moved inside <body> and grouped with other modals) -->
  <div id="performerImportPreviewModal" class="modal" hidden>
    <div class="panel panel--narrow">
      <header class="panel-header--spaced">
        <strong>Import Performers Preview</strong>
        <button id="performerImportPreviewClose" class="btn-sm" title="Cancel">Cancel</button>
      </header>
      <div class="body panel-body--scroll">
        <div class="hint-sm hint-sm--muted">The following performers will be imported:</div>
        <div id="performerImportPreviewList" class="performer-import-list"></div>
      </div>
      <footer class="panel-footer--actions">
        <button id="performerImportPreviewConfirm" class="btn">Import</button>
      </footer>
    </div>
  </div>
  <!-- Folder Picker Modal -->
  <div id="modal" class="modal" hidden>
    <div class="panel">
      <header>
        <div class="crumbs" id="crumbs"></div>
      </header>
      <div class="body">
        <div class="dirlist" id="dirlist"></div>
      </div>
      <div class="actions">
        <button class="btn" id="chooseBtn">Choose this folder</button>
        <button class="btn" id="cancelBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Image Preview Modal -->
  <div id="imgModal" class="modal" hidden>
    <div class="panel panel--image">
      <header>
        <div class="panel-header--spaced">
          <strong>Heatmap Preview</strong>
          <button class="btn" id="imgModalClose">Close</button>
        </div>
      </header>
      <div class="body panel--image-body">
        <img id="imgModalImage" alt="Heatmap" class="panel-image" />
      </div>
    </div>
  </div>
  <!-- Performer Auto-Match Modal (grouped with other modals) -->
  <div id="performerAutoMatchModal" class="modal" hidden>
    <div class="panel panel--wide">
      <header class="flex items-center justify-between gap-16">
        <strong>Auto‑Match Performers</strong>
        <div class="flex gap-8">
          <button id="perfAutoMatchClose" class="btn-sm" title="Close">Close</button>
        </div>
      </header>
      <div class="body panel-body--tall">
        <div class="hint-sm mt-6">Preview scans all videos using registry performers. Apply writes to sidecars.</div>
        <div id="perfAutoMatchStatus" class="hint-sm opacity-75">Awaiting preview.</div>
        <table class="job-table autotag-table mt-8" id="perfAutoMatchTable">
          <thead>
            <tr>
              <th>File</th>
              <th>Performers</th>
            </tr>
          </thead>
          <tbody id="perfAutoMatchTbody"></tbody>
        </table>
      </div>
      <footer class="panel-footer--actions">
        <span class="hint-sm hint-sm--muted">Esc or Close to dismiss • Changes only written after Apply.</span>
        <div class="flex-row gap-8">
          <button id="perfAutoApplyBtnFooter" class="btn-sm" disabled>Apply</button>
          <button id="perfAutoCancelBtn" class="btn-sm">Cancel</button>
        </div>
      </footer>
    </div>
  </div>

  <!-- Performer Image Face Box Preview Modal -->
  <div id="faceBoxModal" class="modal" hidden>
    <div class="panel panel--image">
      <header>
        <div class="panel-header--spaced">
          <strong id="faceBoxTitle">Image Preview</strong>
          <div class="flex-row gap-8">
            <button class="btn" id="faceBoxDetectBtn" title="Auto-detect face box" disabled>Detect</button>
            <button class="btn" id="faceBoxUploadBtn" title="Upload new image">Upload</button>
            <button class="btn" id="faceBoxClose">Close</button>
          </div>
        </div>
      </header>
      <div class="body panel--image-body">
        <div class="facebox-stage">
          <img id="faceBoxImg" alt="Performer" class="panel-image" />
          <div id="faceBoxOverlay" class="facebox-overlay" hidden>
            <div class="handle" aria-hidden="true"></div>
          </div>
          <div id="faceBoxLinks" class="facebox-links hidden" aria-label="External performer links"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tag Merge Modal -->
  <div id="tagMergeModal" class="modal" hidden>
    <div class="panel panel--narrow">
      <header class="panel-header--spaced">
        <h3>Merge Tags</h3>
        <button id="tagMergeClose" class="btn btn-text" aria-label="Close">✕</button>
      </header>
      <div class="body">
        <div class="hint-sm mb-8">Choose the tag name to keep. The other selected tags will be merged into it.</div>
        <div class="row gap-8 mb-10">
          <label class="hint-sm w-120">Selected</label>
          <div id="tagMergeSelected" class="flex-row gap-6"></div>
        </div>
        <div class="row gap-8">
          <label class="hint-sm w-120">Keep name</label>
          <div id="tagMergeChoiceList" class="merge-choice-list" role="radiogroup" aria-live="polite"></div>
        </div>
      </div>
      <footer class="panel-footer--actions">
        <button id="tagMergeCancel" class="btn">Cancel</button>
        <button id="tagMergeConfirm" class="btn btn-primary" disabled>Merge</button>
      </footer>
    </div>
  </div>

  <!-- Tag Rename Modal -->
  <div id="tagRenameModal" class="modal" hidden>
    <div class="panel panel--narrow">
      <header class="panel-header--spaced">
        <h3>Rename Tag</h3>
        <button id="tagRenameClose" class="btn btn-text" aria-label="Close">✕</button>
      </header>
      <div class="body">
        <div class="row gap-8 mb-10">
          <label class="hint-sm w-120">Selected</label>
          <div id="tagRenameSelected" class="flex-row gap-6"></div>
        </div>
        <div class="row gap-8">
          <label for="tagRenameInput" class="hint-sm w-120">New name</label>
          <input id="tagRenameInput" type="text" class="control-input w-100" placeholder="e.g. Vintage" />
        </div>
      </div>
      <footer class="panel-footer--actions">
        <button id="tagRenameCancel" class="btn">Cancel</button>
        <button id="tagRenameConfirm" class="btn btn-primary" disabled>Rename</button>
      </footer>
    </div>
  </div>

  <!-- Error modal (predeclared to avoid dynamic injection) -->
  <div id="errorModal" class="modal" hidden>
    <div class="modal-content modal-content--wide">
      <div class="modal-header modal-header--spaced">
        <h3 class="m-0">Job Error</h3>

        <!-- Small directory list item (used by folder picker) -->
        <template id="dirListItemTemplate">
          <div class="dir">
            <div class="icon"></div>
            <div class="name"></div>
          </div>
        </template>
        <template id="dirEmptyTemplate">
          <div class="dir muted dir-empty">
            <div class="icon dim" aria-hidden="true"></div>
            <div class="name"></div>
          </div>
        </template>
        <template id="dirErrorTemplate">
          <div class="dir dir-error">
            <div class="name"></div>
          </div>
        </template>

        <!-- Autotag preview row template -->
        <template id="autotagRowTemplate">
          <tr>
            <td class="break file"></td>
            <td class="tags"></td>
          </tr>
        </template>

        <!-- Job table row template -->
        <template id="jobRowTemplate">
          <tr>
            <td class="cell-time-start"></td>
            <td class="cell-time-end"></td>
            <td class="cell-task"></td>
            <td class="cell-file" title=""></td>
            <td class="cell-status">
              <span class="job-status"></span>
            </td>
            <td class="cell-progress">
              <div class="job-progress">
                <div class="job-progress-fill"></div>
              </div>
              <div class="cell-sub">
                <span class="pct"></span>
              </div>
            </td>
            <td class="cell-action"></td>
          </tr>
        </template>
        <!-- Marker Row Template -->
        <template id="markerRowTemplate">
          <div class="marker-row">
            <div class="marker-name-label marker-name-label--editable"></div>
            <div class="marker-time-label marker-time-label--editable"></div>
            <button type="button" class="marker-jump marker-btn-icon" aria-label="Jump to marker" title="Jump">
              <svg width="14" height="14" aria-hidden="true" focusable="false">
                <use href="#icon-jump" />
              </svg>
            </button>
            <button type="button" class="marker-remove marker-btn-icon" aria-label="Remove marker" title="Remove">
              <svg width="14" height="14" aria-hidden="true" focusable="false">
                <use href="#icon-clear" />
              </svg>
            </button>
          </div>
        </template>
        <!-- Shared chip templates -->
        <template id="chipTemplate">
          <span class="chip" title="">
            <span class="chip-label"></span>
            <button type="button" class="remove chip-remove" aria-label="Remove">×</button>
          </span>
        </template>
        <template id="chipSuggestTemplate">
          <button type="button" class="chip chip-suggest" title="">
            <span class="chip-label"></span>
          </button>
        </template>
        <template id="bulkSuggestionsLabelTemplate">
          <div class="hint-sm hint-sm--muted mb-4">Matches:</div>
        </template>
        <!-- List filter templates -->
        <template id="listFilterMenuTemplate">
          <div class="list-filter-menu"></div>
        </template>
        <template id="listFilterRowTemplate">
          <div class="row"></div>
        </template>
        <template id="listFilterValuesTemplate">
          <div class="values"></div>
        </template>
        <template id="listFilterFooterTemplate">
          <div class="footer"></div>
        </template>
        <template id="listFilterButtonTemplate">
          <button type="button" class="btn-sm"></button>
        </template>
        <template id="listFilterCheckboxLabelTemplate">
          <label class="list-filter-checkbox">
            <input type="checkbox" />
            <span></span>
          </label>
        </template>
        <template id="listFilterSelectTemplate">
          <select class="control-select"></select>
        </template>
        <template id="listFilterNumberInputTemplate">
          <input type="number" class="chips-input" placeholder="value" />
        </template>
        <template id="listFilterDateInputTemplate">
          <input type="datetime-local" class="chips-input" />
        </template>
        <template id="listFilterHintTemplate">
          <span class="hint-sm"></span>
        </template>
        <template id="listFilterMessageTemplate">
          <div class="row">
            <span class="hint-sm"></span>
          </div>
        </template>
        <template id="listFilterArtifactRowTemplate">
          <label class="list-filter-artifact">
            <span class="label"></span>
            <select class="control-select"></select>
          </label>
        </template>
        <template id="orphanFileTemplate">
          <div class="orphan-file" title="">
            <span class="orphan-file__text"></span>
          </div>
        </template>
        <!-- Segmented select templates -->
        <template id="segmentedControlTemplate">
          <div class="segmented-control" role="group"></div>
        </template>
        <template id="segmentedControlButtonTemplate">
          <button type="button" class="segmented-control__btn" data-value=""></button>
        </template>
        <!-- Artifact filter popover row template -->
        <template id="artifactFilterRowTemplate">
          <label class="artifact-filter-row">
            <span class="artifact-filter-name"></span>
            <select class="control-select artifact-filter-select">
              <option value="">Any</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </label>
        </template>
        <template id="artifactChipTemplate">
          <div class="badge-pill artifact-chip" data-key="" data-present="0">
            <span class="label"></span>
            <span class="status" aria-hidden="true">✗</span>
          </div>
        </template>
        <!-- Tags registry list item template -->
        <template id="registryItemTemplate">
          <div class="registry-item" data-selected="0"></div>
        </template>
        <!-- Breadcrumb segment template -->
        <template id="crumbSegmentTemplate">
          <span class="seg"></span>
        </template>


        <!-- List tab: table cell template -->
        <template id="listCellTemplate">
          <td class="list-cell"></td>
        </template>

        <!-- List tab: table row template -->
        <template id="listRowTemplate">
          <tr class="list-row" data-selected="0" data-path=""></tr>
        </template>

        <!-- List tab: head cell template -->
        <template id="listHeadCellTemplate">
          <th>
            <span class="col-drag-handle" title="Drag to reorder" draggable="true">⋮⋮</span>
            <div class="list-head-cell"></div>
            <div class="col-resizer"></div>
          </th>
        </template>

        <!-- List tab: column settings item template -->
        <template id="listColumnItemTemplate">
          <div class="list-col-item">
            <span class="drag-handle" title="Drag to reorder" aria-hidden="true" draggable="true">⋮⋮</span>
            <label>
              <input type="checkbox" class="list-col-visible" checked />
              <span class="list-col-label">Column</span>
            </label>
          </div>
        </template>
        <!-- Toast notification template -->
        <template id="toastTemplate">
          <div class="toast" role="status" aria-live="polite">
            <span class="toast-text"></span>
          </div>
        </template>
        <button class="btn" id="errorModalClose">Close</button>
      </div>
      <pre id="errorModalText" class="error-pre"></pre>
    </div>
  </div>
  <!-- Generic message modal (replaces legacy alert usage) -->
  <div id="messageModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-header modal-header--spaced">
        <h3 id="messageModalTitle" class="m-0">Notice</h3>
        <button id="messageModalClose" class="btn-sm" aria-label="Close">Close</button>
      </div>
      <div class="modal-body">
        <p id="messageModalBody" class="m-0"></p>
      </div>
      <footer class="panel-footer--actions mt-12">
        <div class="flex-row gap-8 jc-end">
          <button id="messageModalOk" class="btn">OK</button>
        </div>
      </footer>
    </div>
  </div>

  <!-- Templates: API Explorer -->
  <template id="apiGroupTemplate">
    <section class="api-group" data-open="1">
      <header class="api-group__header flex-row gap-10" role="button" tabindex="0" aria-expanded="true">
        <span class="api-group__caret" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24"><use href="#icon-caret"></use></svg>
        </span>
        <h3 class="api-group__title"></h3>
        <button class="btn-xs api-group__expand-all" title="Expand/collapse all children" style="display: none;">±</button>
        <span class="ml-auto hint-sm api-group__count"></span>
      </header>
      <div class="api-group__body"></div>
    </section>
  </template>
  <template id="apiEndpointTemplate">
    <div class="card api-endpoint" data-open="0">
  <div class="api-endpoint__header row" role="button" tabindex="0" aria-expanded="false">
        <span class="method-badge">GET</span>
        <code class="api-path w-100"></code>
        <button class="btn-sm api-toggle" aria-expanded="false" aria-label="Toggle details">Details</button>
      </div>
      <div class="api-endpoint__body hidden">
        <div class="hint-sm api-summary"></div>
        <div class="api-params" role="group" aria-label="Parameters"></div>
        <div class="api-body" hidden>
          <label class="hint-sm">Request Body (JSON)
            <textarea class="api-body-text control-textarea w-100" rows="6" placeholder="{ }"></textarea>
          </label>
        </div>
        <div class="row gap-10 mt-12">
          <button class="btn-sm api-run">Run</button>
          <span class="hint-sm api-status"></span>
        </div>
        <pre class="json-pre api-response mt-12" aria-live="polite"></pre>
      </div>
    </div>
  </template>

  <header>
    <!-- Tab Navigation only (top bar removed) -->
    <nav class="tab-nav" role="tablist" aria-label="Main navigation">
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="player-panel" id="player-tab" data-tab="player">
        Player
      </button>
      <button class="tab-button active" role="tab" aria-selected="true" aria-controls="library-panel" id="library-tab" data-tab="library">
        Library
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="list-panel" id="list-tab" data-tab="list">
        List
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="similar-panel" id="similar-tab" data-tab="similar">
        Similar
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="tasks-panel" id="tasks-tab" data-tab="tasks">
        Tasks
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="performers-panel" id="performers-tab" data-tab="performers">
        Performers
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="graph-panel" id="graph-tab" data-tab="graph">
        Graph
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="connections-panel" id="connections-tab" data-tab="connections">
        Connections
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="tags-panel" id="tags-tab" data-tab="tags">
        Tags
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="stats-panel" id="stats-tab" data-tab="stats">
        Stats
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="settings-panel" id="settings-tab" data-tab="settings">
        Settings
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="api-panel" id="api-tab" data-tab="api">
        API
      </button>
    </nav>
  </header>

  <main>
    <!-- Tab Panels -->
    <div class="tab-panels">
      <!-- Connections Tab Panel (minimal: image-only nodes) -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="connections-tab" id="connections-panel" hidden>
        <section class="graph-panel">
          <div class="graph-controls graph-controls--connections">
            <strong>Connections Graph</strong>
            <label class="hint-sm connections-toggle" title="Show performers even if no portrait is available">
              <input id="connectionsShowImageless" type="checkbox" checked />
              <span>Show imageless performers</span>
            </label>
            <label class="hint-sm" title="Minimum number of videos a performer must appear in to be included">
              Min performer videos
              <input id="connectionsMinVideos" type="number" class="control-input w-120" value="1" min="1" step="1" />
            </label>
            <label class="hint-sm" title="Minimum shared videos required for an edge to be drawn">
              Min shared videos
              <input id="connectionsMinEdgeVideos" type="number" class="control-input w-120" value="1" min="1" step="1" />
            </label>
            <label class="hint-sm connections-toggle" title="Show performers that have no qualifying connections">
              <input id="connectionsShowOrphans" type="checkbox" checked />
              <span>Show orphans</span>
            </label>
            <label class="hint-sm connections-toggle" title="Scale edge thickness based on shared video counts">
              <input id="connectionsVariableThickness" type="checkbox" checked />
              <span>Variable edge width</span>
            </label>
            <div class="ml-auto"></div>
            <button id="connectionsRefreshBtn" class="btn-sm" type="button">Refresh</button>
          </div>
          <div id="connectionsCyContainer">
            <div id="cyConnections" aria-label="Connections graph" role="application"></div>
          </div>
        </section>
      </div>
      <!-- Graph Tab Panel (Performers Co‑appearance) -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="graph-tab" id="graph-panel" hidden>
        <section class="graph-panel">
          <div class="graph-controls">
            <strong>Performers Graph</strong>
            <span id="graphStatus" class="hint-sm" style="opacity:.8;"></span>
            <label class="hint-sm">
              Min videos
              <input id="graphMinCount" type="number" class="control-input w-120" value="2" min="1" step="1" />
            </label>
            <label class="hint-sm" title="Minimum number of connections (edges) a performer must have to be shown; > 0 hides isolated nodes">
              Min edges
              <input id="graphMinEdges" type="number" class="control-input w-120" value="0" min="0" step="1" />
            </label>
            <label class="hint-sm">
              Layout
              <select id="graphLayoutSelect" class="control-input w-120">
                <option value="fcose">fCoSE</option>
                <option value="cose">CoSE</option>
                <option value="circle">Circle</option>
                <option value="grid">Grid</option>
                <option value="random">Random</option>
              </select>
            </label>
            <label class="hint-sm" title="Ideal edge length for force layouts (higher = looser)">
              Edge length
              <input id="graphEdgeLen" type="range" min="40" max="300" step="10" value="120" />
            </label>
            <label class="hint-sm" title="Node repulsion for force layouts (higher = more spread)">
              Node repulsion
              <input id="graphRepulsion" type="range" min="1000" max="120000" step="1000" value="50000" />
            </label>
            <label class="hint-sm" title="Render edges as straight lines">
              <input id="graphStraightEdges" type="checkbox" checked />
              Straight lines
            </label>
            <input id="graphSearchInput" class="control-input" placeholder="Search performer…" />
            <button id="graphRefreshBtn" class="btn-sm">Refresh</button>
            <div class="ml-auto"></div>
            <button id="graphNeighborhoodBtn" class="btn-sm" title="Reveal neighborhood of matches/selection">Reveal Neighborhood</button>
            <button id="graphClearBtn" class="btn-sm" title="Clear filters and highlights">Clear</button>
            <button id="graphFitBtn" class="btn-sm" title="Fit all">Fit</button>
          </div>
          <div id="cyContainer">
            <div id="cyGraph" aria-label="Performers graph" role="application"></div>
          </div>
          <div id="graphTooltip" hidden></div>
        </section>
      </div>
      <!-- Player Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="player-tab" id="player-panel" hidden>
        <!-- Split layout now stretches full height -->
        <div class="player-split">
          <div class="player-sidebar">
            <div id="sidebarAccordion" class="accordion">
              <div class="acc-item" data-key="file-info">
                <button class="acc-header" aria-expanded="true">
                  <svg class="acc-header__icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <use href="#icon-caret"></use>
                    <path class="acc-header__fallback" d="M15 6 L9 12 L15 18 Z" fill="currentColor" />
                  </svg>
                  File Info
                </button>
                <div class="acc-panel">
                  <div class="fi-thumbnail-wrap" id="fiThumbnailWrap">
                    <div class="fi-thumbnail-box">
                      <img id="fiThumbnail" alt="Thumbnail" />
                      <button id="fiSetThumbnailBtn" class="btn btn-xs fi-thumbnail-set" title="Set thumbnail from current frame">✚</button>
                    </div>
                  </div>
                  <div class="file-info-grid" role="table" aria-label="File metadata">
                    <div class="fi-row" role="row">
                      <div class="fi-label" role="rowheader">Path</div>
                      <div class="fi-value break" id="fiPath" role="cell" title="">—</div>
                    </div>
                    <div class="fi-row" role="row">
                      <div class="fi-label" role="rowheader">Duration</div>
                      <div class="fi-value" id="fiDuration" role="cell">—</div>
                    </div>
                    <div class="fi-row" role="row">
                      <div class="fi-label" role="rowheader">Resolution</div>
                      <div class="fi-value" id="fiResolution" role="cell">—</div>
                    </div>
                    <div class="fi-row" role="row">
                      <div class="fi-label" role="rowheader">Video Codec</div>
                      <div class="fi-value" id="fiVideoCodec" role="cell">—</div>
                    </div>
                    <div class="fi-row" role="row">
                      <div class="fi-label" role="rowheader">Audio Codec</div>
                      <div class="fi-value" id="fiAudioCodec" role="cell">—</div>
                    </div>
                    <div class="fi-row" role="row">
                      <div class="fi-label" role="rowheader">Bitrate</div>
                      <div class="fi-value" id="fiBitrate" role="cell">—</div>
                    </div>
                    <div class="fi-row" role="row">
                      <div class="fi-label" role="rowheader">Video Bitrate</div>
                      <div class="fi-value" id="fiVBitrate" role="cell">—</div>
                    </div>
                    <div class="fi-row" role="row">
                      <div class="fi-label" role="rowheader">Audio Bitrate</div>
                      <div class="fi-value" id="fiABitrate" role="cell">—</div>
                    </div>
                    <div class="fi-row" role="row">
                      <div class="fi-label" role="rowheader">Size</div>
                      <div class="fi-value" id="fiSize" role="cell">—</div>
                    </div>
                    <div class="fi-row" role="row">
                      <div class="fi-label" role="rowheader">Modified</div>
                      <div class="fi-value" id="fiModified" role="cell">—</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="acc-item" data-key="markers">
                <button class="acc-header" aria-expanded="false">
                  <svg class="acc-header__icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <use href="#icon-caret"></use>
                    <path class="acc-header__fallback" d="M15 6 L9 12 L15 18 Z" fill="currentColor" />
                  </svg>
                  Markers
                </button>
                <div class="acc-panel hidden">
                  <div class="markers-actions">
                    <button id="btnAddMarker" class="btn btn-xs" type="button" title="Add marker at current time">Add Marker</button>
                    <button id="btnSetIntroEnd" class="btn btn-xs" type="button" title="Set intro end (default start point)">Set Intro</button>
                    <button id="btnSetOutroBegin" class="btn btn-xs" type="button" title="Set outro begin (default end point)">Set Outro</button>
                  </div>
                  <div class="markers-header markers-header--spaced mt-0">
                    <div class="hint-sm hint-sm--muted">Edit time, label, or type. Enter or blur to save. Color indicates marker type.</div>
                  </div>
                  <div id="markersList" class="markers-list" aria-live="polite" aria-label="Scene markers list"></div>
                </div>
              </div>
              <div class="acc-item" data-key="artifacts">
                <button class="acc-header" aria-expanded="false">
                  <svg class="acc-header__icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <use href="#icon-caret"></use>
                    <path class="acc-header__fallback" d="M15 6 L9 12 L15 18 Z" fill="currentColor" />
                  </svg>
                  Artifacts
                </button>
                <div class="acc-panel hidden">
                  <div class="artifact-badges-flat" id="artifactBadgesSidebar">
                    <div id="badge-metadata" class="badge-pill artifact-gen-btn" data-artifact="metadata" title="Metadata">
                      <span>Metadata</span><span id="badge-metadata-status" aria-hidden="true">?</span>
                    </div>
                    <div id="badge-thumbnail" class="badge-pill artifact-gen-btn" data-artifact="thumbnail" title="Primary thumbnail">
                      <span>Thumbnail</span><span id="badge-thumbnail-status" aria-hidden="true">?</span>
                    </div>
                    <div id="badge-preview" class="badge-pill artifact-gen-btn" data-artifact="preview" title="Preview video">
                      <span>Preview</span><span id="badge-preview-status" aria-hidden="true">?</span>
                    </div>
                    <div id="badge-phash" class="badge-pill artifact-gen-btn" data-artifact="phash" title="Perceptual hash">
                      <span>pHash</span>
                      <span id="badge-phash-status" aria-hidden="true">?</span>
                    </div>
                    <div id="badge-sprites" class="badge-pill artifact-gen-btn" data-artifact="sprites" title="Sprite sheet thumbnails (timeline scrub)">
                      <span>Sprites</span><span id="badge-sprites-status" aria-hidden="true">?</span>
                    </div>
                    <div id="badge-heatmap" class="badge-pill artifact-gen-btn" data-artifact="heatmap" title="Heatmap timeline overlay">
                      <span>Heatmap</span><span id="badge-heatmap-status" aria-hidden="true">?</span>
                    </div>
                    <div id="badge-scenes" class="badge-pill artifact-gen-btn" data-artifact="markers" title="Scene / chapter markers">
                      <span>Scenes</span><span id="badge-scenes-status" aria-hidden="true">?</span>
                    </div>
                  </div>
                  <!-- Sidebar artifact previews (compact) -->
                  <div id="sidebarSpritePreview" class="mt-12 hidden" aria-live="polite">
                    <div class="hint-sm hint-sm--muted mb-4">Sprite Sheet</div>
                    <img id="sidebarSpriteImage" alt="Sprites" style="max-width:100%; height:auto; display:block; border-radius:4px; opacity:0.95;" />
                  </div>
                  <div id="sidebarHeatmapPreview" class="mt-12 hidden" aria-live="polite">
                    <div class="hint-sm hint-sm--muted mb-4">Heatmap</div>
                    <img id="sidebarHeatmapImage" alt="Heatmap" style="max-width:100%; height:auto; display:block; border-radius:4px; opacity:0.95;" />
                  </div>
                  <div class="hint-sm mt-6 hint-sm--muted line-13">Click a missing badge (✗) or Generate button to start. ✓ indicates the artifact is present. Spinner shows job progress.</div>
                </div>
              </div>
              <div class="acc-item" data-key="actions">
                <button class="acc-header" aria-expanded="false">
                  <svg class="acc-header__icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <use href="#icon-caret"></use>
                    <path class="acc-header__fallback" d="M15 6 L9 12 L15 18 Z" fill="currentColor" />
                  </svg>
                  Actions
                </button>
                <div class="acc-panel hidden">
                  <div class="flex-row gap-8 mt-4" role="group" aria-label="Video actions">
                    <button id="btnResetPlayer" class="btn-sm" type="button" title="Reset player (unload video)" aria-label="Reset player">
                      <svg width="16" height="16" aria-hidden="true" focusable="false"><use href="#icon-reset" /></svg>
                      <span class="ml-4">Reset player</span>
                    </button>
                    <button id="btnDownloadFrame" class="btn-sm" title="Download current frame as PNG">
                      <svg width="16" height="16" aria-hidden="true" focusable="false"><use href="#icon-camera" /></svg>
                      <span class="ml-4">Download frame</span>
                    </button>
                    <button id="btnConvert" class="btn-sm" disabled title="Coming soon">Convert</button>
                    <button id="btnCompress" class="btn-sm" disabled title="Coming soon">Compress</button>
                    <button id="btnTrim" class="btn-sm" disabled title="Coming soon">Trim</button>
                    <button id="btnSplit" class="btn-sm" disabled title="Coming soon">Split</button>
                    <button id="btnConcat" class="btn-sm" disabled title="Coming soon">Concat</button>
                  </div>
                  <div class="hint-sm hint-sm--muted mt-6">Advanced actions (convert, compress, trim, split, concat) are planned. Download frame works locally now.</div>
                </div>
              </div>
              <div class="acc-item" data-key="video-settings">
                <button class="acc-header" aria-expanded="false">
                  <svg class="acc-header__icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <use href="#icon-caret"></use>
                    <path class="acc-header__fallback" d="M15 6 L9 12 L15 18 Z" fill="currentColor" />
                  </svg>
                  Video
                </button>
                <div class="acc-panel hidden">
                  <div class="video-metadata-chips">
                    <div class="chips-group" id="videoPerformersGroup">
                      <div class="chips-label">Performers</div>
                      <div class="chips-list" id="videoPerformers"></div>
                      <input type="text" id="videoPerformerInput" class="chips-input" placeholder="Add performer…" aria-label="Add performer" />
                      <div class="chips-suggestions hint-sm mt-4" id="videoPerformerSuggestions" aria-live="polite"></div>
                    </div>
                    <div class="chips-group" id="videoTagsGroup">
                      <div class="chips-label">Tags</div>
                      <div class="chips-list" id="videoTags"></div>
                      <input type="text" id="videoTagInput" class="chips-input" placeholder="Add tag…" aria-label="Add tag" />
                      <div class="chips-suggestions hint-sm mt-4" id="videoTagSuggestions" aria-live="polite"></div>
                    </div>
                    <div class="chips-hint hint-sm hint-sm--muted mt-4">Enter to add · Click a chip to view · Click × to remove</div>
                    <!-- Rating (5-star) + Favorite toggle in header -->
                    <div class="chips-group" id="videoRatingGroup">
                      <div class="chips-label">Rating</div>
                      <div class="rating-row">
                        <div class="rating-stars" id="videoRating" role="radiogroup" aria-label="Rating (1 to 5)">
                        <span class="star" role="radio" tabindex="0" data-value="1" aria-label="1 star" aria-checked="false">
                          <svg class="icon icon-outline" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-star"></use></svg>
                          <svg class="icon icon-filled" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-star-filled"></use></svg>
                        </span>
                        <span class="star" role="radio" tabindex="0" data-value="2" aria-label="2 stars" aria-checked="false">
                          <svg class="icon icon-outline" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-star"></use></svg>
                          <svg class="icon icon-filled" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-star-filled"></use></svg>
                        </span>
                        <span class="star" role="radio" tabindex="0" data-value="3" aria-label="3 stars" aria-checked="false">
                          <svg class="icon icon-outline" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-star"></use></svg>
                          <svg class="icon icon-filled" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-star-filled"></use></svg>
                        </span>
                        <span class="star" role="radio" tabindex="0" data-value="4" aria-label="4 stars" aria-checked="false">
                          <svg class="icon icon-outline" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-star"></use></svg>
                          <svg class="icon icon-filled" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-star-filled"></use></svg>
                        </span>
                        <span class="star" role="radio" tabindex="0" data-value="5" aria-label="5 stars" aria-checked="false">
                          <svg class="icon icon-outline" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-star"></use></svg>
                          <svg class="icon icon-filled" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-star-filled"></use></svg>
                        </span>
                        </div>
                        <button id="videoFavorite" class="btn-sm btn-icon favorite-toggle" aria-pressed="false" title="Toggle favorite">
                          <svg class="icon icon-outline" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-heart"></use></svg>
                          <svg class="icon icon-filled" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-heart-filled"></use></svg>
                        </button>
                      </div>
                    </div>
                    <!-- Description -->
                    <div class="chips-group" id="videoDescriptionGroup">
                      <div class="chips-label">Description</div>
                      <div id="videoDescription" class="desc-input" role="textbox" aria-label="Video description" tabindex="0" data-placeholder="Add a description…"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="acc-item" data-key="filters">
                <button class="acc-header" aria-expanded="false">
                  <svg class="acc-header__icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <use href="#icon-caret"></use>
                    <path class="acc-header__fallback" d="M15 6 L9 12 L15 18 Z" fill="currentColor" />
                  </svg>
                  Filters
                </button>
                <div class="acc-panel hidden">
                  <div class="video-adjustments" id="videoAdjustments" aria-label="Video image adjustment controls">
                    <div class="adj-row">
                      <label for="adjBrightness">Brightness</label>
                      <input type="range" id="adjBrightness" class="adj-slider vol-slider" min="0.20" max="2.00" step="0.01" value="1" aria-label="Brightness" />
                      <span class="adj-val" id="adjBrightnessVal">1.00x</span>
                    </div>
                    <div class="adj-row">
                      <label for="adjContrast">Contrast</label>
                      <input type="range" id="adjContrast" class="adj-slider vol-slider" min="0.50" max="2.00" step="0.01" value="1" aria-label="Contrast" />
                      <span class="adj-val" id="adjContrastVal">1.00x</span>
                    </div>
                    <div class="adj-row">
                      <label for="adjSaturation">Saturation</label>
                      <input type="range" id="adjSaturation" class="adj-slider vol-slider" min="0.00" max="3.00" step="0.01" value="1" aria-label="Saturation" />
                      <span class="adj-val" id="adjSaturationVal">1.00x</span>
                    </div>
                    <div class="adj-row">
                      <label for="adjHue">Hue</label>
                      <input type="range" id="adjHue" class="adj-slider vol-slider" min="0" max="360" step="1" value="0" aria-label="Hue rotation" />
                      <span class="adj-val" id="adjHueVal">0°</span>
                    </div>
                    <div class="adj-actions mt-4">
                      <button type="button" id="adjResetBtn" class="btn btn-xs" title="Reset all adjustments">Reset</button>
                    </div>
                    <div class="hint-sm hint-sm--muted mt-6">Adjustments apply locally using CSS filters and persist in this browser. They do not modify files.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Small non-intrusive sidebar toggle between the sidebar and main player -->
          <button id="sidebarToggle" class="sidebar-toggle" aria-expanded="true" aria-label="Toggle sidebar" title="Toggle sidebar">
            <!-- use centralized sprite symbol (icon-caret). CSS will rotate this when collapsed -->
            <svg class="sidebar-toggle__icon" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <title>Toggle sidebar</title>
              <!-- primary: reference centralized symbol -->
              <use href="#icon-caret" />
              <!-- fallback: inline path so the caret is visible if <use> isn't applied by the UA -->
              <path class="sidebar-toggle__fallback" d="M15 6 L9 12 L15 18 Z" fill="currentColor" />
            </svg>
          </button>
          <div class="player-main">
            <div id="playerOverlayBar" class="player-overlay-bar">
              <span id="playerTitle" class="player-title"></span>
            </div>
            <video id="playerVideo" class="player-video" playsinline preload="metadata"></video>
            <!-- Subtitle overlay rendered by JS -->
            <div id="subtitleOverlay" class="subtitle-line bottom" aria-live="polite" hidden></div>
            <!-- Floating scrubber (timeline) overlay at bottom -->
            <div id="playerScrubber" class="player-scrubber-bar">
              <div class="scrubber-track" id="playerScrubberTrack">
                <!-- Heatmap layers moved inside track so width/position match exactly -->
                <div id="timelineHeatmap" class="timeline-heatmap" aria-hidden="true"></div>
                <canvas id="timelineHeatmapCanvas" class="timeline-heatmap-canvas" aria-hidden="true"></canvas>
                <!-- Legacy timeline markers layer expected by JS (renderMarkers) -->
                <div id="timelineMarkers" class="timeline-markers-layer" aria-hidden="true"></div>
                <div class="scrubber-buffer" id="playerScrubberBuffer"></div>
                <div class="scrubber-progress" id="playerScrubberProgress"></div>
              </div>
              <div id="playerControls" class="scrubber-status-row player-controls">
                <span class="scrubber-time" id="playerScrubberTime">00:00 / 00:00</span>
                <div class="player-controls-groups">
                  <div class="player-control-cluster cluster-transport" aria-label="Playback controls">
                    <button id="btnSeekBack30" class="btn btn-xs" type="button" title="Back 30 seconds" aria-label="Back 30 seconds">−30s</button>
                    <button id="btnPrevFrame" class="btn btn-xs" type="button" title="Previous frame" aria-label="Previous frame">−1f</button>
                    <button id="btnPlayPause" class="btn btn-xs" type="button" title="Play / Pause">
                      <svg class="control-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <use href="#icon-play" class="icon-play"></use>
                        <use href="#icon-pause" class="icon-pause hidden"></use>
                      </svg>
                    </button>
                    <button id="btnNextFrame" class="btn btn-xs" type="button" title="Next frame" aria-label="Next frame">+1f</button>
                    <button id="btnSeekFwd30" class="btn btn-xs" type="button" title="Forward 30 seconds" aria-label="Forward 30 seconds">+30s</button>
                  </div>
                  <div class="player-control-cluster cluster-audio" aria-label="Audio controls">
                    <button id="btnMute" class="btn btn-xs" type="button" title="Mute / Unmute">
                      <svg class="control-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <use href="#icon-vol" class="icon-vol"></use>
                        <use href="#icon-muted" class="icon-muted hidden"></use>
                      </svg>
                    </button>
                    <div class="player-volume">
                      <input id="volSlider" class="vol-slider" type="range" min="0" max="1" step="0.01" value="1" title="Volume" />
                    </div>
                  </div>
                  <div class="player-control-cluster cluster-navigate" aria-label="Navigation controls">
                    <button id="btnPrevVideo" class="btn btn-xs" type="button" title="Previous video" aria-label="Previous video">
                      <svg class="control-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <use href="#icon-prev"></use>
                      </svg>
                      <span class="sr-only">Previous video</span>
                    </button>
                    <button id="btnRestartVideo" class="btn btn-xs" type="button" title="Restart video" aria-label="Restart video">
                      <svg class="control-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <use href="#icon-restart"></use>
                      </svg>
                    </button>
                    <button id="btnFullscreen" class="btn btn-xs" type="button" title="Toggle fullscreen" aria-label="Fullscreen">
                      <svg class="control-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M4 4h6v2H6v4H4V4zm10 0h6v6h-2V6h-4V4zM6 14v4h4v2H4v-6h2zm12 0h2v6h-6v-2h4v-4z" />
                      </svg>
                    </button>
                    <button id="btnNextVideo" class="btn btn-xs" type="button" title="Next video" aria-label="Next video">
                      <svg class="control-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <use href="#icon-next"></use>
                      </svg>
                      <span class="sr-only">Next video</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- Hover sprite preview (dynamically positioned) -->
            <div id="spritePreview"></div>
          </div>
        </div>
      </div>

      <!-- Library Tab Panel -->
      <div class="tab-panel active" role="tabpanel" aria-labelledby="library-tab" id="library-panel">
        <div class="controls-panel sticky-enabled library-toolbar">
          <div class="library-toolbar__surface">
            <div class="controls-row library-toolbar__row library-toolbar__row--primary">
              <div id="libraryUnifiedFiltersGroup" class="control-group control-group--flex library-toolbar__cluster library-toolbar__cluster-search">
                <button id="clearFiltersTopBtn" class="btn-icon clear-btn" type="button" aria-label="Clear filters" title="Clear search, tags, performers and resolution">
                  <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><use href="#icon-clear"></use></svg>
                </button>
                <input type="text" id="libraryUnifiedInput" class="chips-input" placeholder="Search files, #tag, @performer…" aria-label="Search library" />
                <div class="chips-list" id="libraryUnifiedChips"></div>
              </div>
              <div class="control-group library-toolbar__cluster library-toolbar__cluster-options" aria-label="Library view options">
                <div class="compact-filter" data-filter="resolution">
                  <div class="compact-filter__label-row">
                    <label for="resSelect" class="compact-filter__label">Resolution</label>
                  </div>
                  <select id="resSelect" class="control-select" title="Filter by resolution" aria-label="Filter by resolution">
                    <option value="" selected data-chip="All">All resolutions</option>
                    <option value="2160" data-chip="2160p+">2160p+</option>
                    <option value="1440" data-chip="1440p+">1440p+</option>
                    <option value="1080" data-chip="1080p+">1080p+</option>
                    <option value="720" data-chip="720p+">720p+</option>
                    <option value="480" data-chip="480p+">480p+</option>
                  </select>
                </div>
                <div class="compact-filter" data-filter="sort">
                  <div class="compact-filter__label-row">
                    <label for="sortSelect" class="compact-filter__label">Sort</label>
                    <button id="orderToggle" class="compact-filter__order" data-order="desc" type="button" title="Toggle sort order" aria-label="Toggle sort order">▼</button>
                  </div>
                  <select id="sortSelect" class="control-select" aria-label="Sort by">
                    <option value="date" data-chip="Date">Date</option>
                    <option value="name" data-chip="Name">Name</option>
                    <option value="size" data-chip="Size">Size</option>
                    <option value="random" data-chip="Random">Random</option>
                  </select>
                </div>
                <div class="library-density" aria-label="Grid density">
                  <span class="library-density__label hint-sm" id="densityLabel">Density</span>
                  <input id="densitySlider" type="range" min="1" max="15" value="12" step="1" class="control-slider" title="Adjust grid density (columns)" aria-describedby="densityLabel" aria-label="Grid density" />
                </div>
              </div>
            </div>
            <div class="controls-row library-toolbar__row library-toolbar__row--secondary">
              <div class="control-group library-toolbar__cluster library-toolbar__cluster-artifacts">
                <button id="artifactFiltersBtn" class="btn-sm" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="artifactFiltersMenu">Artifacts</button>
                <div id="artifactFilterChips" class="artifact-filter-chips" aria-live="polite" hidden></div>
                <!-- Artifact boolean filters are available per-column on the List tab -->
              </div>
              <div class="pagination-group library-toolbar__cluster library-toolbar__cluster-pagination">
                <div class="pagination">
                  <button id="prevBtn" class="btn-sm" title="Previous page">‹</button>
                  <span id="pageInfo" class="page-info">Page 1 of 1</span>
                  <button id="nextBtn" class="btn-sm" title="Next page">›</button>
                </div>
                <div class="library-toolbar__random" role="group" aria-label="Random playback">
                  <button id="randomPlayBtn" class="btn-sm" title="Play a random video from current filters" aria-label="Play random">
                    <svg width="16" height="16" aria-hidden="true" focusable="false"><use href="#icon-shuffle" /></svg>
                  </button>
                  <button id="randomAutoBtn" class="btn-sm" title="Toggle auto-random play when the video ends" aria-pressed="false" aria-label="Toggle auto-random">
                    <svg width="16" height="16" aria-hidden="true" focusable="false"><use href="#icon-auto-shuffle" /></svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="artifactFiltersMenu" class="artifact-filter-menu" role="dialog" aria-label="Artifact filters" hidden>
          <div class="artifact-filter-menu__body" id="artifactFilterMenuBody"></div>
          <div class="artifact-filter-menu__footer">
            <button id="artifactFiltersClearBtn" class="btn-sm" type="button">Clear</button>
            <button id="artifactFiltersApplyBtn" class="btn-sm btn-primary" type="button">Apply</button>
          </div>
        </div>

        <div id="selectionBar" class="selection-bar" hidden>
          <span id="selectionCount" class="selection-count">0 selected</span>
          <button id="selectAllBtn" class="btn-sm">Select All</button>
          <button id="selectNoneBtn" class="btn-sm">Select None</button>
          <button id="bulkEditBtn" class="btn-sm">Bulk Edit</button>
          <div id="bulkEditPanel" class="bulk-panel" hidden>
            <label class="hint-sm mr-6" for="bulkKindSelect">Type</label>
            <select id="bulkKindSelect" class="control-select">
              <option value="tag">Tag</option>
              <option value="performer">Performer</option>
            </select>
            <label class="hint-sm ml-10 mr-6" for="bulkOpSelect">Action</label>
            <select id="bulkOpSelect" class="control-select">
              <option value="add">Add</option>
              <option value="remove">Remove</option>
            </select>
            <input id="bulkValueInput" type="text" class="chips-input ml-10" placeholder="Name…" aria-label="Name" />
            <button id="bulkApplyBtn" class="btn-sm ml-6">Apply</button>
            <div id="bulkSuggestions" class="chips-suggestions hint-sm mt-4" aria-live="polite"></div>
          </div>
        </div>

        <div id="spinner" class="spinner"></div>
        <div id="status"></div>

        <!-- Card template (hidden) -->
        <template id="cardTemplate">
          <div class="card">
            <div class="card-checkbox"></div>
            <div class="thumbnail-wrap">
              <div class="quality-badge" aria-hidden="true"></div>
              <img class="thumbnail-img" loading="lazy" />
              <!-- Inline placeholder SVG using centralized sprite; shown when no thumbnail present -->
              <svg class="thumbnail-placeholder" aria-hidden="true">
                <use href="#icon-placeholder"></use>
              </svg>
              <!-- Overlay info (resolution only) -->
              <div class="overlay-info" aria-hidden="true">
                <span class="overlay-resolution"></span>
              </div>
            </div>
            <div class="metadata">
              <p class="title"></p>
              <div class="row sub">
                <span class="duration"></span>
                <span class="size"></span>
              </div>
            </div>
          </div>
        </template>

        <!-- Directory card template (hidden) -->
        <template id="dirTemplate">
          <div class="card">
            <div class="thumbnail-img dir-thumbnail">
              <div class="dir-thumbnail-inner">
                <span class="dir-icon"></span>
                <span class="dir-name"></span>
              </div>
            </div>
            <div class="metadata">
              <p class="title"></p>
              <div class="row sub"><span>Folder</span><span></span></div>
            </div>
          </div>
        </template>

        <div id="grid" class="grid" hidden></div>
      </div>

      <!-- List Tab Panel (static) -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="list-tab" id="list-panel" hidden>
        <div class="list-panel">
          <div class="list-controls">
            <div class="flex-row gap-8">
              <button id="listColumnsBtn" class="btn-sm" aria-controls="listColumnsPanel" aria-expanded="false">Columns</button>
              <button id="listWrapToggle" class="btn-sm" aria-pressed="false" title="Toggle text wrapping in the table">Wrap: On</button>
              <label for="listPageSize" class="hint-sm" style="display:inline-flex; align-items:center; gap:6px;">
                Per page
                <select id="listPageSize" class="control-select" aria-label="Page size">
                  <option value="16">16</option>
                  <option value="32" selected>32</option>
                  <option value="64">64</option>
                  <option value="128">128</option>
                  <option value="256">256</option>
                  <option value="500">500</option>
                </select>
              </label>
              <div id="listFilterChips" class="filter-chips" aria-label="Active list filters" hidden></div>
              <div class="list-pager" id="listPagerTop">
                <button id="listPrevBtn" class="btn-sm" aria-label="Previous page">Prev</button>
                <span id="listPageInfo" class="hint-sm">Page 1</span>
                <button id="listNextBtn" class="btn-sm" aria-label="Next page">Next</button>
              </div>
              <div id="listSpinner" class="spinner" hidden></div>
            </div>
          </div>
          <div id="listColumnsPanel" class="list-columns-panel hidden" role="region" aria-label="Column settings">
            <div class="panel-header--spaced">
              <strong>Columns</strong>
              <button id="listColumnsClose" class="btn-sm" aria-label="Close">Close</button>
            </div>
            <div id="listColumnsBody" class="list-columns-body"></div>
            <div class="list-columns-footer mt-12">
              <div class="hint-sm hint-sm--muted">Drag to reorder • Toggle to show/hide • Resize using header grips in the table</div>
              <button id="listColumnsReset" class="btn-sm" type="button">Reset to default</button>
            </div>
          </div>
          <div class="list-wrap">
            <table id="listTable" class="list-table" role="table" aria-label="Files list">
              <thead>
                <tr id="listHeadRow"></tr>
              </thead>
              <tbody id="listTbody"></tbody>
            </table>
          </div>
          <div class="list-pager-bottom" id="listPagerBottom">
            <div class="list-pager">
              <button id="listPrevBtnBottom" class="btn-sm" aria-label="Previous page">Prev</button>
              <span id="listPageInfoBottom" class="hint-sm">Page 1</span>
              <button id="listNextBtnBottom" class="btn-sm" aria-label="Next page">Next</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Performers Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="performers-tab" id="performers-panel" hidden>
        <div class="catalog-container">
          <div class="perf-toolbar">
            <input id="performerSearch" type="text" placeholder="Search performers…" class="perf-search" />
            <div class="compact-filter" data-filter="perf-images">
              <div class="compact-filter__label-row">
                <span class="compact-filter__label">Images</span>
              </div>
              <select id="performerImageFilter" class="control-select sr-only" aria-label="Filter performers by image availability" data-segmented="1" data-segmented-label="Performer image filter">
                <option value="all" selected data-chip="All">All</option>
                <option value="with" data-chip="With">Has image</option>
                <option value="without" data-chip="Missing">No image</option>
              </select>
            </div>
            <div class="compact-filter" data-filter="perf-face">
              <div class="compact-filter__label-row">
                <span class="compact-filter__label">Face box</span>
              </div>
              <select id="performerFaceFilter" class="control-select sr-only" aria-label="Filter performers by face box status" data-segmented="1" data-segmented-label="Performer face box filter">
                <option value="all" selected data-chip="All">All</option>
                <option value="with" data-chip="With">Has face box</option>
                <option value="without" data-chip="Missing">No face box</option>
              </select>
            </div>
            <!-- Sort controls: default to Scenes (desc) -->
            <div class="compact-filter ml-8" data-filter="perf-sort">
              <div class="compact-filter__label-row">
                <span class="compact-filter__label">Sort</span>
                <button id="performerSortOrder" class="compact-filter__order" type="button" title="Toggle sort order" aria-label="Toggle sort order">▼</button>
              </div>
              <select id="performerSort" class="control-select sr-only" aria-label="Sort performers" data-segmented="1" data-segmented-label="Performer sort">
                <option value="count" selected data-chip="Files">Files</option>
                <option value="name" data-chip="Name">Name</option>
              </select>
            </div>
            <span id="performersCount" class="hint-sm ml-8" aria-live="polite"></span>
            <button id="performerUnifiedImportBtn" class="btn-sm" title="Import performers: names list, images folder, loose images, or ZIP">Import</button>
            <button id="performerAddBtn" class="btn-sm" title="Create a new performer">Add</button>
            <button id="performerAutoMatchBtn" class="btn-sm" title="Match performers from filenames">Match</button>
            <button id="performerDetectAllBtn" class="btn-sm" title="Detect faces for visible performers">Detect faces</button>
            <button id="performerMergeBtn" class="btn-sm" title="Merge selected" disabled>Merge</button>
            <button id="performerRenameBtn" class="btn-sm" title="Rename selected" disabled>Rename</button>
            <button id="performerDeleteBtn" class="btn-sm" title="Delete selected" disabled>Delete</button>
          </div>
          <div id="performerDropZone" role="button" tabindex="0" aria-label="Import performers" class="performer-dropzone">
            <strong class="pdz-title">Unified Import</strong>
            <span class="pdz-sub">Click for names / images / ZIP or drag & drop text list</span>
          </div>
          <input id="performerFileInput" type="file" accept=".txt,.csv,.json,text/plain,application/json" multiple class="d-none" />
          <div id="performersStatus" class="catalog-status d-none" aria-live="polite">Loading…</div>
          <!-- Unified hidden inputs -->
          <input id="performerUnifiedFileInput" type="file" class="d-none" multiple accept=".txt,.csv,.json,.zip,image/*,text/plain,application/json,application/zip,application/x-zip-compressed" />
          <input id="performerUnifiedFolderInput" type="file" class="d-none" webkitdirectory directory multiple accept="image/*" />
          <input id="performerSingleImageInput" type="file" class="d-none" accept="image/*" />
          <div id="performersSpinner" class="spinner" hidden></div>
          <div class="list-controls flex-row gap-10 mt-12" id="performersPager">
            <div class="ml-auto"></div>
            <label for="perfPageSize" class="hint-sm">Page size</label>
            <select id="perfPageSize" class="control-select" aria-label="Performers page size">
              <option value="16">16</option>
              <option value="32" selected>32</option>
              <option value="64">64</option>
              <option value="128">128</option>
            </select>
            <button id="perfPrev" class="btn-sm" aria-label="Previous page">Prev</button>
            <span id="perfPageInfo" class="hint-sm" aria-live="polite">—</span>
            <button id="perfNext" class="btn-sm" aria-label="Next page">Next</button>
          </div>
          <div id="performersGrid" class="perf-grid performers-grid"></div>
          <!-- Bottom pager (duplicate of top) -->
          <div class="list-controls flex-row gap-10 mt-12" id="performersPagerBottom">
            <div class="ml-auto"></div>
            <label for="perfPageSizeBottom" class="hint-sm">Page size</label>
            <select id="perfPageSizeBottom" class="control-select" aria-label="Performers page size (bottom)">
              <option value="16">16</option>
              <option value="32" selected>32</option>
              <option value="64">64</option>
              <option value="128">128</option>
            </select>
            <button id="perfPrevBottom" class="btn-sm" aria-label="Previous page">Prev</button>
            <span id="perfPageInfoBottom" class="hint-sm" aria-live="polite">—</span>
            <button id="perfNextBottom" class="btn-sm" aria-label="Next page">Next</button>
          </div>
        </div>
      </div>

      <!-- Performer Merge Modal -->
      <div id="performerMergeModal" class="modal" hidden>
        <div class="panel panel--narrow">
          <header class="panel-header--spaced">
            <h3>Merge Performers</h3>
            <button id="performerMergeClose" class="btn btn-text" aria-label="Close">✕</button>
          </header>
          <div class="body">
            <div class="hint-sm mb-8">Choose the performer name to keep. The other selected performer(s) will be merged into it.</div>
            <div class="row gap-8 mb-10">
              <label class="hint-sm w-120">Selected</label>
              <div id="performerMergeSelected" class="flex-row gap-6"></div>
            </div>
            <div class="row gap-8">
              <label for="performerMergeInto" class="hint-sm w-120">Name that remains</label>
              <input id="performerMergeInto" type="text" class="control-input w-100" placeholder="e.g. Jane Doe" />
            </div>
          </div>
          <footer class="panel-footer--actions">
            <button id="performerMergeCancel" class="btn">Cancel</button>
            <button id="performerMergeConfirm" class="btn btn-primary" disabled>Merge</button>
          </footer>
        </div>
      </div>

      <!-- Performer Rename Modal -->
      <div id="performerRenameModal" class="modal" hidden>
        <div class="panel panel--narrow">
          <header class="panel-header--spaced">
            <h3>Rename Performer</h3>
            <button id="performerRenameClose" class="btn btn-text" aria-label="Close">✕</button>
          </header>
          <div class="body">
            <div class="row gap-8 mb-10">
              <label class="hint-sm w-120">Selected</label>
              <div id="performerRenameSelected" class="flex-row gap-6"></div>
            </div>
            <div class="row gap-8">
              <label for="performerRenameInput" class="hint-sm w-120">New name</label>
              <input id="performerRenameInput" type="text" class="control-input w-100" placeholder="e.g. Jane Doe" />
            </div>
          </div>
          <footer class="panel-footer--actions">
            <button id="performerRenameCancel" class="btn">Cancel</button>
            <button id="performerRenameConfirm" class="btn btn-primary" disabled>Rename</button>
          </footer>
        </div>
      </div>

      <!-- Tags Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="tags-tab" id="tags-panel" hidden>
        <!-- Tags grid (extant tags with counts) -->
        <div class="catalog-container">
          <div class="perf-toolbar">
            <input id="tagSearch" type="text" placeholder="Search tags…" class="perf-search" />
            <label for="tagSort" class="hint-sm ml-8" style="opacity:.8">Sort</label>
            <select id="tagSort" class="control-select" aria-label="Sort tags">
              <option value="count" selected>Files</option>
              <option value="name">Name</option>
            </select>
            <button id="tagSortOrder" class="btn-sm" title="Toggle sort order" aria-label="Toggle sort order">Desc</button>
            <span id="tagsCount" class="hint-sm ml-8" aria-live="polite"></span>
            <button id="tagImportBtn" class="btn-sm" title="Import tags from JSON">Import</button>
            <button id="tagAddBtn" class="btn-sm" title="Create a new tag">Add</button>
            <button id="tagAutoMatchBtn" class="btn-sm" title="Apply a tag by matching filenames">Match</button>
            <button id="tagMergeBtn" class="btn-sm" title="Merge selected" disabled>Merge</button>
            <button id="tagRenameBtn" class="btn-sm" title="Rename selected" disabled>Rename</button>
            <button id="tagDeleteBtn" class="btn-sm" title="Delete selected" disabled>Delete</button>
          </div>
          <div id="tagDropZone" role="button" tabindex="0" aria-label="Import tags" class="performer-dropzone">
            <strong class="pdz-title">Import Tags</strong>
            <span class="pdz-sub">Click to choose a file or drag & drop JSON / newline list</span>
          </div>
          <input id="tagImportFile" type="file" accept=".txt,.csv,.json,text/plain,application/json" class="d-none" />
          <div id="tagsStatus" class="catalog-status d-none" aria-live="polite">Loading…</div>
          <div id="tagsSpinner" class="spinner" hidden></div>
          <div class="list-controls flex-row gap-10 mt-12" id="tagsPager">
            <div class="ml-auto"></div>
            <label for="tagPageSize" class="hint-sm">Page size</label>
            <select id="tagPageSize" class="control-select" aria-label="Tags page size">
              <option value="16">16</option>
              <option value="32" selected>32</option>
              <option value="64">64</option>
              <option value="128">128</option>
            </select>
            <button id="tagPrev" class="btn-sm" aria-label="Previous page">Prev</button>
            <span id="tagPageInfo" class="hint-sm" aria-live="polite">—</span>
            <button id="tagNext" class="btn-sm" aria-label="Next page">Next</button>
          </div>
          <div id="tagsGrid" class="perf-grid performers-grid"></div>
          <div class="list-controls flex-row gap-10 mt-12" id="tagsPagerBottom">
            <div class="ml-auto"></div>
            <label for="tagPageSizeBottom" class="hint-sm">Page size</label>
            <select id="tagPageSizeBottom" class="control-select" aria-label="Tags page size (bottom)">
              <option value="16">16</option>
              <option value="32" selected>32</option>
              <option value="64">64</option>
              <option value="128">128</option>
            </select>
            <button id="tagPrevBottom" class="btn-sm" aria-label="Previous page">Prev</button>
            <span id="tagPageInfoBottom" class="hint-sm" aria-live="polite">—</span>
            <button id="tagNextBottom" class="btn-sm" aria-label="Next page">Next</button>
          </div>
        </div>
      </div>

      <!-- Template: Similar row (pair) -->
      <template id="similarRowTemplate">
        <div class="card similar-row">
          <div class="row jc-between ai-center">
            <strong class="similar-title">—</strong>
            <div class="row gap-10">
              <button class="btn-sm play-a">Play A</button>
              <button class="btn-sm play-b">Play B</button>
            </div>
          </div>
          <div class="hint-sm mt-6">
            <div class="path-a"></div>
            <div class="path-b"></div>
          </div>
        </div>
      </template>

      <!-- Similar Tab Panel (static) -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="similar-tab" id="similar-panel" hidden>
        <div class="task-section">
          <div class="section-header">
            <h2>Similar (pHash)</h2>
            <div class="section-actions">
              <label class="hint-sm">Threshold <input id="similarThresh" type="number" min="0" max="1" step="0.01" value="0.90" class="w-120" /></label>
              <label class="hint-sm">Limit <input id="similarLimit" type="number" min="1" step="1" value="50" class="w-120" /></label>
              <label class="hint-sm"><input id="similarRecursive" type="checkbox" /> Recursive</label>
              <button id="similarRefreshBtn" class="btn-sm">Refresh</button>
            </div>
          </div>
          <div id="similarStatus" class="hint-sm hint-sm--muted">—</div>
          <div id="similarResults" class="mt-12"></div>
        </div>
      </div>

      <!-- API Explorer Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="api-tab" id="api-panel" hidden>
        <div class="task-section">
          <div class="section-header">
            <h2>API Explorer</h2>
            <div class="section-actions">
              <button id="apiReloadSpecBtn" class="btn-sm" aria-label="Reload API spec">Reload Spec</button>
              <label for="apiSearch" class="sr-only">Filter endpoints</label>
              <input id="apiSearch" type="text" class="control-input" placeholder="Filter paths…" aria-label="Filter endpoints" />
            </div>
          </div>
          <div class="api-composer">
            <div class="row gap-10">
              <label for="apiMethod" class="sr-only">HTTP method</label>
              <select id="apiMethod" class="control-select" aria-label="HTTP method">
                <option>GET</option>
                <option>POST</option>
                <option>PUT</option>
                <option>PATCH</option>
                <option>DELETE</option>
              </select>
              <label for="apiPath" class="sr-only">Request path</label>
              <input id="apiPath" class="control-input w-100" placeholder="/api/health" aria-label="Request path" />
              <button id="apiExecBtn" class="btn-sm" aria-label="Execute request">Execute</button>
            </div>
            <div class="row gap-10 mt-12">
              <div class="w-100">
                <label class="hint-sm" for="apiQueryJson">Query (JSON object)</label>
                <textarea id="apiQueryJson" class="control-textarea w-100" rows="4" placeholder="{\n  \"page\": 1\n}"></textarea>
              </div>
              <div class="w-100">
                <label class="hint-sm" for="apiBodyJson">Body (JSON)</label>
                <textarea id="apiBodyJson" class="control-textarea w-100" rows="4" placeholder="{ }"></textarea>
              </div>
            </div>
            <div class="row gap-10 mt-12">
              <span id="apiComposerStatus" class="hint-sm"></span>
            </div>
            <pre id="apiComposerResponse" class="json-pre mt-12" aria-live="polite"></pre>
          </div>
        </div>
        <div class="task-section">
          <div class="section-header">
            <h2>Endpoints</h2>
            <div class="section-actions">
              <label class="toggle-label" for="apiTreeToggle">
                <input id="apiTreeToggle" type="checkbox" checked aria-label="Toggle tree view" />
                <span>Tree View</span>
              </label>
              <button id="apiEndpointsToggleAllBtn" class="btn-sm" aria-expanded="false" aria-controls="apiEndpointsList">Expand All</button>
            </div>
          </div>
          <div id="apiEndpointsList" class="api-endpoints-list"></div>
        </div>
      </div>

      <!-- Tasks Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="tasks-tab" id="tasks-panel" hidden>
        <div class="tasks-container">

          <!-- Job Monitor Section -->
          <div class="task-section">
            <div class="section-header">
              <h2>Job Monitor</h2>
              <div class="section-actions">
                <button id="pauseToggleBtn" class="btn-sm" title="Pause starting new jobs" aria-pressed="false">
                  <svg width="16" height="16" aria-hidden="true" focusable="false">
                    <use href="#icon-pause"></use>
                  </svg>
                  <span class="ml-4">Pause</span>
                </button>
                <!-- Buttons hidden initially; JS toggles .d-none -->
                <button id="cancelAllBtn" class="btn-sm d-none" title="Cancel all queued and running jobs">Cancel All</button>
                <button id="cancelQueuedBtn" class="btn-sm d-none" title="Cancel all queued jobs">Cancel Queued</button>
                <button id="clearCompletedBtn" class="btn-sm d-none" title="Remove completed jobs from the list">Clear Completed</button>
              </div>
            </div>

            <div class="job-stats">
              <div class="stat-card" id="filterQueued" data-filter="queued" title="Show only queued jobs">
                <span class="stat-label">Queued</span>
                <span class="stat-value" id="queuedJobsCount">0</span>
              </div>
              <div class="stat-card" id="filterActive" data-filter="running" title="Show only active (running) jobs">
                <span class="stat-label">Active</span>
                <span class="stat-value" id="activeJobsCount">0</span>
              </div>
              <div class="stat-card" id="filterCompleted" data-filter="completed" title="Show completed jobs">
                <span class="stat-label">Completed</span>
                <span class="stat-value" id="completedJobsCount">0</span>
              </div>
              <div class="stat-card" id="filterErrored" data-filter="failed" title="Show failed jobs">
                <span class="stat-label">Errored</span>
                <span class="stat-value" id="failedJobsCount">0</span>
              </div>
            </div>

            <div class="job-table-container" id="jobTableContainer">
              <table class="job-table">
                <thead>
                  <tr>
                    <th>Start</th>
                    <th>Finish</th>
                    <th>Task</th>
                    <th>File</th>
                    <th>Status</th>
                    <th>Progress</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="jobTableBody">
                  <!-- Jobs will be populated here -->
                </tbody>
              </table>
              <div class="resize-handle" id="jobResizeHandle" title="Drag to resize job list"></div>
            </div>
          </div>

          <!-- Artifact Generation Section -->
          <div class="task-section">
            <div class="section-header">
              <h2>Generate Artifacts</h2>
            </div>

            <!-- File Selection -->
            <div class="file-selection">
              <div class="selection-options">
                <label class="selection-option">
                  <input type="radio" name="fileSelection" value="all" checked>
                  All files in library
                </label>
                <label class="selection-option">
                  <input type="radio" name="fileSelection" value="selected">
                  Selected files (<span id="selectedFileCount">0</span>)
                </label>
                <button id="generateAllBtn" class="btn-sm ml-auto" title="Queue all missing artifacts for the chosen scope">Generate All</button>
              </div>
            </div>

            <!-- Artifact Types -->
            <div class="artifact-grid">

              <div class="artifact-card artifact-card-uniform" data-artifact="metadata">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Metadata</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="metadataCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="metadataFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="metadata-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="metadata-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="metadata-clear" title="Delete all metadata JSON files">Clear</button>
                  </div>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="thumbnail">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Thumbnails</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="thumbnailsCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="thumbnailsFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="thumbnails-missing" title="Generate missing thumbnails">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="thumbnails-all" title="Recompute all thumbnails">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="thumbnails-clear" title="Delete all generated thumbnails without regenerating">Clear</button>
                    <button class="btn-options" data-artifact="thumbnail" title="Options" aria-label="Thumbnail options">
                      <svg width="16" height="16" aria-hidden="true">
                        <use href="#icon-options" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="thumbnailOptions">
                  <label>Offset (seconds): <input type="number" id="thumbnailOffset" value="10" min="1" max="3600"></label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="preview">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Previews</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="previewsCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="previewsFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="previews-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="previews-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="previews-clear" title="Delete all preview videos">Clear</button>
                    <button class="btn-options" data-artifact="preview" aria-label="Preview options">
                      <svg width="16" height="16" aria-hidden="true">
                        <use href="#icon-options" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="previewOptions">
                  <label>Segments: <input type="number" id="previewSegments" value="9" min="5" max="20"></label>
                  <label>Duration (sec): <input type="number" id="previewDuration" value="1.0" min="0.5" max="3.0" step="0.1"></label>
                  <label>Width (px): <input type="number" id="previewWidth" value="320" min="120" max="1280"></label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="sprites">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Sprite Sheets</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="spritesCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="spritesFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="sprites-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="sprites-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="sprites-clear" title="Delete all sprite sheets">Clear</button>
                    <button class="btn-options" data-artifact="sprites" aria-label="Sprite options">
                      <svg width="16" height="16" aria-hidden="true">
                        <use href="#icon-options" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="spritesOptions">
                  <label>Interval (sec): <input type="number" id="spriteInterval" value="10" min="1" max="60"></label>
                  <label>Width (px): <input type="number" id="spriteWidth" value="320" min="160" max="1920"></label>
                  <label>Columns: <input type="number" id="spriteCols" value="10" min="5" max="20"></label>
                  <label>Rows: <input type="number" id="spriteRows" value="10" min="3" max="40"></label>
                  <label>Quality (0-8): <input type="number" id="spriteQuality" value="4" min="0" max="8"></label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="phash">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Perceptual Hash</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="phashCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="phashFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="phash-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="phash-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="phash-clear" title="Delete all perceptual hash artifacts">Clear</button>
                    <button class="btn-options" data-artifact="phash">
                      <svg width="16" height="16" aria-hidden="true">
                        <use href="#icon-options" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="phashOptions">
                  <label>Frames: <input type="number" id="phashFrames" value="5" min="3" max="10"></label>
                  <label>Algorithm:
                    <div class="select">
                      <select id="phashAlgo" class="control-select">
                        <option value="ahash">Average Hash</option>
                        <option value="phash">Perceptual Hash</option>
                        <option value="dhash">Difference Hash</option>
                      </select>
                      <span class="chevron">▾</span>
                    </div>
                  </label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="markers">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Scene Detection</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="markersCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="markersFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="markers-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="markers-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="markers-clear" title="Delete all scene detection JSON">Clear</button>
                    <button class="btn-options" data-artifact="markers">
                      <svg width="16" height="16" aria-hidden="true">
                        <use href="#icon-options" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="markersOptions">
                  <label>Threshold: <input type="number" id="sceneThreshold" value="0.4" min="0.1" max="1.0" step="0.1"></label>
                  <label>Limit: <input type="number" id="sceneLimit" value="0" min="0" max="100"></label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="heatmap">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Heatmap</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="heatmapCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="heatmapFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="heatmap-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="heatmap-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="heatmap-clear" title="Delete all heatmap PNGs">Clear</button>
                    <button class="btn-options" data-artifact="heatmap">
                      <svg width="16" height="16" aria-hidden="true">
                        <use href="#icon-options" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="heatmapOptions">
                  <label>Interval (sec): <input type="number" id="heatmapInterval" value="1.0" min="0.5" max="10.0" step="0.5"></label>
                  <label>Mode:
                    <div class="select">
                      <select id="heatmapMode" class="control-select">
                        <option value="both">Both</option>
                        <option value="brightness">Brightness</option>
                        <option value="motion">Motion</option>
                        <option value="color">Color</option>
                      </select>
                      <span class="chevron">▾</span>
                    </div>
                  </label>
                  <label class="row small items-center gap-6">
                    <input type="checkbox" id="heatmapPng" checked /> Save PNG
                  </label>
                </div>
              </div>

              <!-- Embeddings (recompute embeddings without re-detecting boxes) -->
              <div class="artifact-card artifact-card-uniform hidden" data-artifact="embed" hidden style="display: none;">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Embeddings</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="embedCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="embedFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="embed-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="embed-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="embed-clear" title="Delete all embedding vectors">Clear</button>
                    <button class="btn-options" data-artifact="embed" title="Options">
                      <svg width="16" height="16" aria-hidden="true">
                        <use href="#icon-options" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="embedOptions">
                  <label>Interval (sec): <input type="number" id="embedInterval" value="1.0" min="0.5" max="10.0" step="0.5"></label>
                  <label>Min Size: <input type="number" id="embedMinSize" value="0.10" min="0.05" max="0.5" step="0.05"></label>
                  <label>Backend:
                    <div class="select">
                      <select id="embedBackend" class="control-select">
                        <option value="auto" selected>Auto</option>
                        <option value="opencv">OpenCV</option>
                        <option value="insightface">InsightFace</option>
                      </select>
                      <span class="chevron">▾</span>
                    </div>
                  </label>
                  <label>Similarity Thresh: <input type="number" id="embedSimThresh" value="0.9" min="0.1" max="1.0" step="0.05"></label>
                </div>
              </div>
            </div>
          </div>
          <!-- Orphaned Artifacts Section -->
          <div class="task-section">
            <div class="section-header">
              <h2>Orphaned Artifacts</h2>
            </div>
            <div class="orphan-card">
              <div class="orphan-header">
                <div class="orphan-info">
                  <h3>Orphaned Files</h3>
                  <div class="orphan-stats">
                    <span class="orphan-count" id="orphanCount">0</span>
                    <span class="orphan-label">files without corresponding videos</span>
                  </div>
                </div>
                <div class="orphan-actions">
                  <button class="btn-preview" id="previewOrphansBtn" disabled title="Show suggested cleanup (dry run)">Preview Cleanup</button>
                  <!-- Apply Cleanup is hidden until a preview is displayed -->
                  <button class="btn-cleanup d-none" id="cleanupOrphansBtn" disabled title="Apply cleanup (removes unmatched orphans)">Apply Cleanup</button>
                  <button class="btn-preview" id="previewRepairsBtn" disabled title="Show suggested renames (dry run)">Preview Repairs</button>
                  <!-- Apply Repairs is hidden until repair preview streaming completes -->
                  <button class="btn-cleanup d-none" id="applyRepairsBtn" disabled title="Apply suggested repairs (move artifacts next to best-matched media; keeps unmatched orphans)">Apply Repairs</button>
                </div>
              </div>
              <div class="orphan-details d-none" id="orphanDetails">
                <div class="orphan-list" id="orphanList">
                  <!-- Orphan files will be listed here -->
                </div>
              </div>
              <div class="orphan-details d-none" id="orphanRenames">
                <div class="orphan-list" id="orphanRenamesList">
                  <!-- Suggested renames (dry run) will be listed here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="stats-tab" id="stats-panel" hidden>
        <div class="stats-container">
          <h2>Library Statistics</h2>
          <div class="stats-row">
            <div class="stats-item"><strong>Number of Files:</strong> <span id="statsNumFiles">—</span></div>
            <div class="stats-item"><strong>Total Size:</strong> <span id="statsTotalSize">—</span></div>
            <div class="stats-item"><strong>Total Duration:</strong> <span id="statsTotalDuration">—</span></div>
            <div class="stats-item"><strong>Number of Tags:</strong> <span id="statsNumTags">—</span></div>
            <div class="stats-item"><strong>Number of Performers:</strong> <span id="statsNumPerformers">—</span></div>
          </div>
          <div class="stats-charts">
            <div class="chart-block">
              <h3>Resolution Distribution</h3>
              <canvas id="statsResChart" width="320" height="180"></canvas>
            </div>
            <div class="chart-block">
              <h3>Duration Distribution</h3>
              <canvas id="statsDurationChart" width="320" height="180"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="settings-tab" id="settings-panel" hidden>
        <div class="tab-content">
          <h2>Settings</h2>
          <div class="task-section task-section-spaced">
            <div class="section-header">
              <h2>Library Root</h2>
            </div>
            <div class="file-selection file-selection-root">
              <div class="root-input-row">
                <input id="folderInput" type="text" class="control-input root-input" placeholder="Type relative path (Enter) or absolute path to set root" title="Relative path to browse; absolute path to change root. Enter to apply." />
                <button id="refresh" class="btn-sm" title="Reload current listing">Reload</button>
                <button id="pickRootBtn" class="btn-sm" title="Open folder picker">Pick…</button>
              </div>
              <div class="hint-sm">
                Enter a relative path within the current root to browse (e.g. <code>Shows/Season 1</code>). Enter an absolute path (e.g. <code>/Volumes/Media</code> or <code>~/Movies</code>) to change the library root. Double‑click the input or click Pick… to open a folder picker.
              </div>
            </div>
          </div>
          <div class="task-section task-section-spaced">
            <div class="section-header">
              <h2>Player Preferences</h2>
            </div>
            <div class="file-selection file-selection-compact">
              <label class="selection-option selection-option-wide">
                <div class="fw-600">Seek jumps (seconds)</div>
                <div class="row gap-10" style="align-items:center; flex-wrap:wrap; margin-top:4px">
                  <div class="flex-row gap-10" style="align-items:center">
                    <label for="settingJumpBackSeconds" class="hint-sm" style="opacity:.8">Back</label>
                    <input type="number" id="settingJumpBackSeconds" min="1" max="600" step="1" value="30" class="w-120" aria-label="Jump backward seconds" />
                  </div>
                  <div class="flex-row gap-10" style="align-items:center">
                    <label for="settingJumpFwdSeconds" class="hint-sm" style="opacity:.8">Forward</label>
                    <input type="number" id="settingJumpFwdSeconds" min="1" max="600" step="1" value="30" class="w-120" aria-label="Jump forward seconds" />
                  </div>
                  <span class="hint-sm" style="opacity:.75; flex-basis:100%">Values used by the ± buttons & Arrow Left/Right (when not frame-stepping).</span>
                </div>
              </label>
              <label class="selection-option selection-option-wide">
                <input type="checkbox" id="settingInfiniteScroll" />
                <div>
                  <div class="subtitle-icon-label">Infinite Scroll (auto-load next page)</div>
                  <div class="hint-sm">When enabled, scrolling near the end of the library automatically loads the next page instead of using the pager.</div>
                </div>
              </label>
              <label class="selection-option selection-option-wide mt-12">
                <input type="checkbox" id="settingStartAtBeginning" />
                <div>
                  <div class="fw-600">Always start videos at the beginning</div>
                  <div class="hint-sm">Ignores saved progress, resume overrides, and intro skip markers so playback always begins from 00:00.</div>
                </div>
              </label>
              <label class="selection-option selection-option-wide">
                <input type="checkbox" id="settingAutoplayResume" />
                <div>
                  <div class="subtitle-icon-label">
                    Autoplay on load when previously playing
                    <!-- reference subtitle icon placeholder (from user image) -->
                    <span aria-hidden="true" title="Subtitle icon reference" class="subtitle-icon">
                      <span class="subtitle-line top"></span>
                      <span class="subtitle-line bottom"></span>
                    </span>
                  </div>
                  <div class="hint-sm">
                    If enabled, the player resumes playback automatically when a video was playing before closing. Default is off.
                  </div>
                </div>
              </label>
              <label class="selection-option selection-option-wide mt-12">
                <input type="checkbox" id="settingShowHeatmap" />
                <div>
                  <div class="fw-600">Show timeline heatmap</div>
                  <div class="hint-sm">
                    Toggle the heatmap overlay on the player timeline. This only affects display; artifacts and badges still load as usual.
                  </div>
                </div>
              </label>
              <label class="selection-option selection-option-wide mt-12">
                <input type="checkbox" id="settingShowScenes" />
                <div>
                  <div class="fw-600">Show scene boundary markers</div>
                  <div class="hint-sm">
                    Toggle the scene boundary ticks on the player timeline. This only affects display; scenes data still loads as usual.
                  </div>
                </div>
              </label>
            </div>
          </div>
          <div class="task-section task-section-spaced">
            <div class="section-header">
              <h2>Library Preferences</h2>
            </div>
            <div class="file-selection file-selection-compact">
              <label class="selection-option selection-option-wide">
                <input type="checkbox" id="settingPreview" />
                <div>
                  <div class="fw-600">Enable video previews</div>
                  <div class="hint-sm">When enabled, cards will play a small preview on hover. Previews are only played if they already exist; no background generation is triggered automatically.</div>
                </div>
              </label>
              <label class="selection-option selection-option-wide mt-12">
                <input type="checkbox" id="settingPreviewOnDemand" />
                <div>
                  <div class="fw-600">Generate previews on demand</div>
                  <div class="hint-sm">When enabled, hovering a card will request the server to create a preview if one doesn’t exist yet. This may start background work and use CPU.</div>
                </div>
              </label>
              <label class="selection-option selection-option-wide mt-12">
                <input type="checkbox" id="settingConfirmDeletes" />
                <div>
                  <div class="fw-600">Require confirmation for deletions</div>
                  <div class="hint-sm">When enabled, clearing or deleting artifacts will ask for confirmation. Default is off.</div>
                </div>
              </label>
            </div>
          </div>
          <div class="task-section task-section-spaced">
            <div class="section-header">
              <h2>Job Processing</h2>
            </div>
            <div class="file-selection file-selection-compact file-selection-inline">
              <div class="flex-row gap-16 w-100">
                <div class="fw-600">Max concurrent jobs</div>
                <input type="number" id="settingConcurrency" min="1" max="16" step="1" value="4" class="w-120" />
              </div>
            </div>
            <div class="file-selection file-selection-compact file-selection-inline mt-12">
              <div class="flex-row gap-16 w-100">
                <div class="fw-600">FFmpeg parallel processes</div>
                <input type="number" id="settingFfmpegConcurrency" min="1" max="16" step="1" value="4" class="w-120" />
              </div>
            </div>
            <div class="file-selection file-selection-compact file-selection-inline mt-8">
              <div class="flex-row gap-16 w-100">
                <div class="fw-600">FFmpeg threads per process</div>
                <input type="number" id="settingFfmpegThreads" min="1" max="32" step="1" value="1" class="w-120" />
              </div>
            </div>
            <div class="file-selection file-selection-compact file-selection-inline mt-8">
              <div class="flex-row gap-16 w-100">
                <div class="fw-600">FFmpeg timelimit (s)</div>
                <input type="number" id="settingFfmpegTimelimit" min="0" max="86400" step="10" value="600" class="w-120" />
              </div>
            </div>
            <div class="hint-sm mt-8 max-w-640">FFmpeg settings control low-level media processing. Parallel processes multiply workload across different files; threads apply within a single process. Lower timelimit can fail very long operations; set 0 to disable.</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Toast host (notifications rendered via template clones) -->
  <div id="toastHost" aria-live="polite" aria-atomic="false"></div>
</body>
</html>
