<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Media Library</title>
  <link rel="stylesheet" href="index.css" />
  <link rel="preload" href="icons.svg" as="image" type="image/svg+xml" />
  <script src="index.js" defer></script>
</head>

<body>
  <header>
    <!-- Tab Navigation only (top bar removed) -->
    <nav class="tab-nav" role="tablist" aria-label="Main navigation">
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="player-panel" id="player-tab" data-tab="player">
        Player
      </button>
      <button class="tab-button active" role="tab" aria-selected="true" aria-controls="library-panel" id="library-tab" data-tab="library">
        Library
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="tasks-panel" id="tasks-tab" data-tab="tasks">
        Tasks
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="performers-panel" id="performers-tab" data-tab="performers">
        Performers
      </button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="settings-panel" id="settings-tab" data-tab="settings">
        Settings
      </button>
    </nav>
  </header>

  <main>
    <!-- Tab Panels -->
    <div class="tab-panels">
      <!-- Player Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="player-tab" id="player-panel" hidden>
        <div class="player-shell no-sidebar">
          <div class="player-main">
            <div class="player-header-simple">
              <h2 id="playerTitle" class="player-title">No file</h2>
            </div>
            <div class="player-stage-simple">
              <div id="videoStage" class="video-stage-simple">
                <video id="playerVideo" playsinline class="video-el"></video>
                <div class="timeline-overlay-shell">
                  <div class="timeline-wrapper">
                    <div id="timeline" class="timeline-flat">
                      <div id="timelineHeatmap" class="timeline-heatmap"></div>
                      <canvas id="timelineHeatmapCanvas" class="timeline-heatmap-canvas"></canvas>
                      <div id="timelineProgress" class="timeline-progress"></div>
                      <div id="timelineMarkers" class="timeline-markers"></div>
                    </div>
                  </div>
                  <div id="playerBar" class="player-bar-overlay">
                    <button id="btnPlayPause" class="btn-sm icon-btn" aria-label="Play/Pause" data-icon-state="play">
                      <svg class="icon icon-play">
                        <use href="icons.svg#icon-play" />
                      </svg>
                      <svg class="icon icon-pause" hidden>
                        <use href="icons.svg#icon-pause" />
                      </svg>
                    </button>
                    <div class="time-display"><span id="curTime">00:00</span><span class="sep">/</span><span id="totalTime">00:00</span></div>
                    <div class="spacer"></div>
                    <button id="btnMute" class="btn-sm icon-btn" aria-label="Mute / Unmute">
                      <svg class="icon icon-vol">
                        <use href="icons.svg#icon-volume" />
                      </svg>
                      <svg class="icon icon-muted" hidden>
                        <use href="icons.svg#icon-muted" />
                      </svg>
                    </button>
                    <input id="volSlider" class="vol-slider" type="range" min="0" max="1" step="0.01" value="1" title="Volume" aria-label="Volume" />
                    <button id="btnCC" class="btn-sm icon-btn" aria-label="Captions"><svg class="icon">
                        <use href="icons.svg#icon-cc" />
                      </svg></button>
                    <select id="rateSelect" class="control-select rate-select-inline" aria-label="Speed">
                      <option value="0.5">0.5×</option>
                      <option value="0.75">0.75×</option>
                      <option value="1" selected>1×</option>
                      <option value="1.25">1.25×</option>
                      <option value="1.5">1.5×</option>
                      <option value="1.75">1.75×</option>
                      <option value="2">2×</option>
                    </select>
                    <button id="btnPip" class="btn-sm icon-btn" aria-label="Picture in Picture"><svg class="icon">
                        <use href="icons.svg#icon-pip" />
                      </svg></button>
                    <button id="btnFullscreen" class="btn-sm icon-btn" aria-label="Fullscreen"><svg class="icon">
                        <use href="icons.svg#icon-full" />
                      </svg></button>
                    <button id="btnAddMarker" class="btn-sm icon-btn util-btn" title="Add marker" aria-label="Add marker"><svg class="icon">
                        <use href="icons.svg#icon-marker" />
                      </svg></button>
                    <button id="btnSetThumb" class="btn-sm icon-btn util-btn" title="Set cover image" aria-label="Set cover"><svg class="icon">
                        <use href="icons.svg#icon-thumb" />
                      </svg></button>
                  </div>
                </div>
              </div>
              <div id="spritePreview" class="sprite-preview"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Hidden SVG filters for video color matrix -->
      <!-- Removed inline icon sprite (now exclusively using external icons.svg). Retain only needed filter definitions inline. -->
      <svg width="0" height="0" class="sprite-defs-hidden" aria-hidden="true" focusable="false">
        <filter id="playerColorMatrix" color-interpolation-filters="sRGB">
          <feColorMatrix id="playerColorMatrixValues" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0" />
        </filter>
      </svg>

      <!-- Library Tab Panel -->
      <div class="tab-panel active" role="tabpanel" aria-labelledby="library-tab" id="library-panel">
        <div class="controls-panel">
          <div class="controls-row">
            <div class="control-group">
              <!-- <span class="control-label">Search</span> -->
              <input id="searchInput" type="text" class="control-input" placeholder="Search files..." />
            </div>
            <div class="control-group">
              <div class="select">
                <select id="resSelect" class="control-select" title="Filter by resolution">
                  <option value="" selected>All resolutions</option>
                  <option value="2160">2160p+</option>
                  <option value="1440">1440p+</option>
                  <option value="1080">1080p+</option>
                  <option value="720">720p+</option>
                  <option value="480">480p+</option>
                </select>
                <span class="chevron">▾</span>
              </div>
            </div>
            <div class="control-group">
              <!-- <span class="control-label">Sort</span> -->
              <div class="select">
                <select id="sortSelect" class="control-select">
                  <option value="date">Date</option>
                  <option value="name">Name</option>
                  <option value="size">Size</option>
                  <option value="random">Random</option>
                </select>
                <span class="chevron">▾</span>
              </div>
              <button id="orderToggle" class="btn-sm order-btn" data-order="desc" title="Toggle sort order">▼</button>
            </div>
            <div class="pagination-group">
              <div class="control-group">
                <!-- <span class="control-label">Density</span> -->
                <input id="densitySlider" type="range" min="1" max="15" value="12" step="1" class="control-slider" title="Adjust grid density (columns)" />
              </div>
              <div class="pagination">
                <button id="prevBtn" class="btn-sm" title="Previous page">‹</button>
                <span id="pageInfo" class="page-info">Page 1 of 1</span>
                <button id="nextBtn" class="btn-sm" title="Next page">›</button>
              </div>
            </div>
          </div>
        </div>
        <div id="selectionBar" class="selection-bar" hidden>
          <span id="selectionCount" class="selection-count">0 selected</span>
          <button id="selectAllBtn" class="btn-sm">Select All</button>
          <button id="selectNoneBtn" class="btn-sm">Select None</button>
        </div>

        <div id="spinner" class="spinner"></div>
        <div id="status"></div>

        <!-- Card template (hidden) -->
        <template id="cardTemplate">
          <div class="card">
            <div class="card-checkbox"></div>
            <div class="thumb-wrap">
              <div class="quality-badge" aria-hidden="true"></div>
              <img class="thumb" loading="lazy" />
              <!-- Overlay info (resolution only) -->
              <div class="overlay-info" aria-hidden="true">
                <span class="overlay-resolution"></span>
              </div>
            </div>
            <div class="meta">
              <p class="title"></p>
              <div class="row sub">
                <span class="duration"></span>
                <span class="size"></span>
              </div>
            </div>
          </div>
        </template>

        <!-- Directory card template (hidden) -->
        <template id="dirTemplate">
          <div class="card">
            <div class="thumb dir-thumb">
              <div class="dir-thumb-inner">
                <span class="dir-icon"></span>
                <span class="dir-name"></span>
              </div>
            </div>
            <div class="meta">
              <p class="title"></p>
              <div class="row sub"><span>Folder</span><span></span></div>
            </div>
          </div>
        </template>

        <div id="grid" class="grid" hidden></div>
      </div>

      <!-- Performers Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="performers-tab" id="performers-panel" hidden>
        <div class="perf-toolbar">
          <input id="performerSearch" type="text" placeholder="Search performers…" class="perf-search" />
          <button id="performerAddBtn" class="btn-sm d-none">Add</button>
          <button id="performerImportBtn" class="btn-sm" title="Import newline or JSON list">Import</button>
          <button id="performerMergeBtn" class="btn-sm" title="Merge selected" disabled>Merge</button>
          <button id="performerDeleteBtn" class="btn-sm" title="Delete selected" disabled>Delete</button>
        </div>
        <div id="performerDropZone" role="button" tabindex="0" aria-label="Import performers" class="performer-dropzone">
          <strong class="pdz-title">Import Performers</strong>
          <span class="pdz-sub">Click to choose files or drag & drop names / JSON / text list</span>
        </div>
        <input id="performerFileInput" type="file" accept=".txt,.csv,.json,text/plain,application/json" multiple class="d-none" />
        <div id="performersStatus" class="performers-status d-none">Loading…</div>
        <div id="performersGrid" class="perf-grid performers-grid">
          <!-- Cards injected dynamically -->
        </div>
      </div>

      <!-- Tasks Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="tasks-tab" id="tasks-panel" hidden>
        <div class="tasks-container">

          <!-- Job Monitor Section -->
          <div class="task-section">
            <div class="section-header">
              <h2>Job Monitor</h2>
              <div class="section-actions">
                <button id="cancelAllBtn" class="btn-sm d-none" title="Cancel all queued and running jobs">Cancel All</button>
                <button id="cancelQueuedBtn" class="btn-sm d-none" title="Cancel all queued jobs">Cancel Queued</button>
                <button id="clearCompletedBtn" class="btn-sm d-none" title="Remove completed jobs from the list">Clear Completed</button>
              </div>
            </div>

            <div class="job-stats">
              <div class="stat-card" id="filterQueued" data-filter="queued" title="Show only queued jobs">
                <span class="stat-label">Queued</span>
                <span class="stat-value" id="queuedJobsCount">0</span>
              </div>
              <div class="stat-card" id="filterActive" data-filter="running" title="Show only active (running) jobs">
                <span class="stat-label">Active</span>
                <span class="stat-value" id="activeJobsCount">0</span>
              </div>
              <div class="stat-card" id="filterCompleted" data-filter="completed" title="Show completed jobs">
                <span class="stat-label">Completed</span>
                <span class="stat-value" id="completedJobsCount">0</span>
              </div>
              <div class="stat-card" id="filterErrored" data-filter="failed" title="Show failed jobs">
                <span class="stat-label">Errored</span>
                <span class="stat-value" id="failedJobsCount">0</span>
              </div>
            </div>

            <div class="job-table-container" id="jobTableContainer">
              <table class="job-table">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Task</th>
                    <th>File</th>
                    <th>Status</th>
                    <th>Progress</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="jobTableBody">
                  <!-- Jobs will be populated here -->
                </tbody>
              </table>
              <div class="resize-handle" id="jobResizeHandle" title="Drag to resize"></div>
            </div>
          </div>

          <!-- Artifact Generation Section -->
          <div class="task-section">
            <div class="section-header">
              <h2>Generate Artifacts</h2>
            </div>

            <!-- File Selection -->
            <div class="file-selection">
              <div class="selection-options">
                <label class="selection-option">
                  <input type="radio" name="fileSelection" value="all" checked>
                  All files in library
                </label>
                <label class="selection-option">
                  <input type="radio" name="fileSelection" value="selected">
                  Selected files (<span id="selectedFileCount">0</span>)
                </label>
                <button id="generateAllBtn" class="btn-sm ml-auto" title="Queue all missing artifacts for the chosen scope">Generate All</button>
              </div>
            </div>

            <!-- Artifact Types -->
            <div class="artifact-grid">

              <div class="artifact-card artifact-card-uniform" data-artifact="metadata">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Metadata</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="metadataCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="metadataFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="metadata-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="metadata-all">Recompute All</button>
                  </div>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="thumbnails">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Thumbnails</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="thumbnailsCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="thumbnailsFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="thumbnails-missing" title="Generate missing thumbnails">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="thumbnails-all" title="Recompute all thumbnails">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="thumbnails-clear" title="Delete all generated thumbnails without regenerating">Clear</button>
                    <button class="btn-options" data-artifact="thumbnails" title="Options" aria-label="Thumbnail options">
                      <svg width="14" height="14" aria-hidden="true">
                        <use href="icons.svg#icon-options" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="thumbnailsOptions">
                  <label>Offset (seconds): <input type="number" id="thumbnailOffset" value="10" min="1" max="3600"></label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="sprites">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Sprite Sheets</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="spritesCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="spritesFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="sprites-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="sprites-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="sprites-clear" title="Delete all sprite sheets">Clear</button>
                    <button class="btn-options" data-artifact="sprites" aria-label="Sprite options">
                      <svg width="14" height="14" aria-hidden="true">
                        <use href="icons.svg#icon-options" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="spritesOptions">
                  <label>Interval (sec): <input type="number" id="spriteInterval" value="10" min="1" max="60"></label>
                  <label>Width (px): <input type="number" id="spriteWidth" value="320" min="160" max="1920"></label>
                  <label>Columns: <input type="number" id="spriteCols" value="10" min="5" max="20"></label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="previews">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Hover Previews</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="previewsCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="previewsFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="previews-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="previews-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="previews-clear" title="Delete all hover preview videos">Clear</button>
                    <button class="btn-options" data-artifact="previews" aria-label="Hover preview options">
                      <svg width="14" height="14" aria-hidden="true">
                        <use href="icons.svg#icon-options" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="previewsOptions">
                  <label>Segments: <input type="number" id="previewSegments" value="9" min="5" max="20"></label>
                  <label>Duration (sec): <input type="number" id="previewDuration" value="1.0" min="0.5" max="3.0" step="0.1"></label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="phash">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Perceptual Hash</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="phashCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="phashFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="phash-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="phash-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="phash-clear" title="Delete all perceptual hash artifacts">Clear</button>
                    <button class="btn-options" data-artifact="phash">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="phashOptions">
                  <label>Frames: <input type="number" id="phashFrames" value="5" min="3" max="10"></label>
                  <label>Algorithm:
                    <div class="select">
                      <select id="phashAlgo" class="control-select">
                        <option value="ahash">Average Hash</option>
                        <option value="phash">Perceptual Hash</option>
                        <option value="dhash">Difference Hash</option>
                      </select>
                      <span class="chevron">▾</span>
                    </div>
                  </label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="scenes">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Scene Detection</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="scenesCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="scenesFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="scenes-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="scenes-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="scenes-clear" title="Delete all scene detection JSON">Clear</button>
                    <button class="btn-options" data-artifact="scenes">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="scenesOptions">
                  <label>Threshold: <input type="number" id="sceneThreshold" value="0.4" min="0.1" max="1.0" step="0.1"></label>
                  <label>Limit: <input type="number" id="sceneLimit" value="0" min="0" max="100"></label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="heatmaps">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Heatmaps</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="heatmapsCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="heatmapsFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="heatmaps-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="heatmaps-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="heatmaps-clear" title="Delete all heatmap PNGs">Clear</button>
                    <button class="btn-options" data-artifact="heatmaps">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="heatmapsOptions">
                  <label>Interval (sec): <input type="number" id="heatmapInterval" value="1.0" min="0.5" max="10.0" step="0.5"></label>
                  <label>Mode:
                    <div class="select">
                      <select id="heatmapMode" class="control-select">
                        <option value="brightness">Brightness</option>
                        <option value="motion">Motion</option>
                        <option value="color">Color</option>
                      </select>
                      <span class="chevron">▾</span>
                    </div>
                  </label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="subtitles">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Subtitles</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="subtitlesCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="subtitlesFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="subtitles-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="subtitles-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="subtitles-clear" title="Delete all subtitle files">Clear</button>
                    <button class="btn-options" data-artifact="subtitles">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="subtitlesOptions">
                  <label>Model:
                    <div class="select">
                      <select id="subtitleModel" class="control-select">
                        <option value="tiny">Tiny</option>
                        <option value="base">Base</option>
                        <option value="small" selected>Small</option>
                        <option value="medium">Medium</option>
                        <option value="large">Large</option>
                      </select>
                      <span class="chevron">▾</span>
                    </div>
                  </label>
                  <label>Language: <input type="text" id="subtitleLang" placeholder="auto" maxlength="5"></label>
                </div>
              </div>

              <div class="artifact-card artifact-card-uniform" data-artifact="faces">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Face Detection</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="facesCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="facesFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="faces-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="faces-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="faces-clear" title="Delete face detection JSON & embeddings">Clear</button>
                    <button class="btn-options" data-artifact="faces">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="facesOptions">
                  <label>Interval (sec): <input type="number" id="faceInterval" value="1.0" min="0.5" max="10.0" step="0.5"></label>
                  <label>Min Size: <input type="number" id="faceMinSize" value="0.10" min="0.05" max="0.5" step="0.05"></label>
                  <label>Backend:
                    <div class="select">
                      <select id="faceBackend" class="control-select">
                        <option value="auto" selected>Auto</option>
                        <option value="opencv">OpenCV</option>
                        <option value="insightface">InsightFace</option>
                      </select>
                      <span class="chevron">▾</span>
                    </div>
                  </label>
                  <label>Scale Factor: <input type="number" id="faceScale" value="1.1" min="1.01" max="2.0" step="0.01"></label>
                  <label>Min Neighbors: <input type="number" id="faceMinNeighbors" value="5" min="0" max="20" step="1"></label>
                  <label>Similarity Thresh: <input type="number" id="faceSimThresh" value="0.9" min="0.1" max="1.0" step="0.05"></label>
                  <div class="embed-extra">
                    <button class="btn-sm" id="facesBrowserBtn" title="Detect faces in your browser and upload the result">
                      Generate Faces (Browser)
                    </button>
                    <div class="hint-sm">
                      Uses your browser's built-in FaceDetector to find faces and uploads boxes. The server will compute lightweight embeddings for clustering.
                    </div>
                  </div>
                </div>
              </div>

              <!-- Embeddings (recompute embeddings without re-detecting boxes) -->
              <div class="artifact-card artifact-card-uniform" data-artifact="embed">
                <div class="artifact-header">
                  <div class="artifact-info">
                    <h3>Embeddings</h3>
                    <div class="coverage-display">
                      <span class="coverage-text" id="embedCoverage">0%</span>
                      <div class="coverage-bar-mini">
                        <div class="coverage-fill-mini" id="embedFill"></div>
                      </div>
                    </div>
                  </div>
                  <div class="artifact-actions">
                    <button class="btn-generate hidden" data-operation="embed-missing">Generate Missing</button>
                    <button class="btn-generate d-none hidden" data-operation="embed-all">Recompute All</button>
                    <button class="btn-generate d-none hidden" data-operation="embed-clear" title="Delete all embedding vectors">Clear</button>
                    <button class="btn-options" data-artifact="embed" title="Options">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V12a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="options-tooltip d-none" id="embedOptions">
                  <label>Interval (sec): <input type="number" id="embedInterval" value="1.0" min="0.5" max="10.0" step="0.5"></label>
                  <label>Min Size: <input type="number" id="embedMinSize" value="0.10" min="0.05" max="0.5" step="0.05"></label>
                  <label>Backend:
                    <div class="select">
                      <select id="embedBackend" class="control-select">
                        <option value="auto" selected>Auto</option>
                        <option value="opencv">OpenCV</option>
                        <option value="insightface">InsightFace</option>
                      </select>
                      <span class="chevron">▾</span>
                    </div>
                  </label>
                  <label>Similarity Thresh: <input type="number" id="embedSimThresh" value="0.9" min="0.1" max="1.0" step="0.05"></label>
                </div>
              </div>
            </div>
          </div>
          <!-- Orphaned Artifacts Section -->
          <div class="task-section">
            <div class="section-header">
              <h2>Orphaned Artifacts</h2>
            </div>
            <div class="orphan-card">
              <div class="orphan-header">
                <div class="orphan-info">
                  <h3>Orphaned Files</h3>
                  <div class="orphan-stats">
                    <span class="orphan-count" id="orphanCount">0</span>
                    <span class="orphan-label">files without corresponding videos</span>
                  </div>
                </div>
                <div class="orphan-actions">
                  <button class="btn-cleanup" id="cleanupOrphansBtn" disabled>Clean Up</button>
                  <button class="btn-preview" id="previewOrphansBtn" disabled>Preview</button>
                </div>
              </div>
              <div class="orphan-details d-none" id="orphanDetails">
                <div class="orphan-list" id="orphanList">
                  <!-- Orphan files will be listed here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Tab Panel -->
      <div class="tab-panel" role="tabpanel" aria-labelledby="settings-tab" id="settings-panel" hidden>
        <div class="tab-content">
          <h2>Settings</h2>
          <div class="task-section task-section-spaced">
            <div class="section-header">
              <h2>Library Root</h2>
            </div>
            <div class="file-selection file-selection-root">
              <div class="root-input-row">
                <input id="folderInput" type="text" class="control-input root-input" placeholder="Type relative path (Enter) or absolute path to set root" title="Relative path to browse; absolute path to change root. Enter to apply." />
                <button id="refresh" class="btn-sm" title="Reload current listing">Reload</button>
                <button id="pickRootBtn" class="btn-sm" title="Open folder picker">Pick…</button>
              </div>
              <div class="hint-sm">
                Enter a relative path within the current root to browse (e.g. <code>Shows/Season 1</code>). Enter an absolute path (e.g. <code>/Volumes/Media</code> or <code>~/Movies</code>) to change the library root. Double‑click the input or click Pick… to open a folder picker.
              </div>
            </div>
          </div>
          <div class="task-section task-section-spaced">
            <div class="section-header">
              <h2>Player Preferences</h2>
            </div>
            <div class="file-selection file-selection-compact">
              <label class="selection-option selection-option-wide">
                <input type="checkbox" id="settingAutoplayResume" />
                <div>
                  <div class="subtitle-icon-label">
                    Autoplay on load when previously playing
                    <!-- reference subtitle icon placeholder (from user image) -->
                    <span aria-hidden="true" title="Subtitle icon reference" class="subtitle-icon">
                      <span class="subtitle-line top"></span>
                      <span class="subtitle-line bottom"></span>
                    </span>
                  </div>
                  <div class="hint-sm">
                    If enabled, the player resumes playback automatically when a video was playing before closing. Default is off.
                  </div>
                </div>
              </label>
              <label class="selection-option selection-option-wide mt-12">
                <input type="checkbox" id="settingShowHeatmap" />
                <div>
                  <div class="fw-600">Show timeline heatmap</div>
                  <div class="hint-sm">
                    Toggle the heatmap overlay on the player timeline. This only affects display; artifacts and badges still load as usual.
                  </div>
                </div>
              </label>
              <label class="selection-option selection-option-wide mt-12">
                <input type="checkbox" id="settingShowScenes" />
                <div>
                  <div class="fw-600">Show scene boundary markers</div>
                  <div class="hint-sm">
                    Toggle the scene boundary ticks on the player timeline. This only affects display; scenes data still loads as usual.
                  </div>
                </div>
              </label>
            </div>
          </div>
          <div class="task-section task-section-spaced">
            <div class="section-header">
              <h2>Library Preferences</h2>
            </div>
            <div class="file-selection file-selection-compact">
              <label class="selection-option selection-option-wide">
                <input type="checkbox" id="settingHoverPreviews" />
                <div>
                  <div class="fw-600">Enable hover video previews</div>
                  <div class="hint-sm">
                    When enabled, cards will play a small preview on hover. Previews are only played if they already exist; no background generation is triggered automatically.
                  </div>
                </div>
              </label>
              <label class="selection-option selection-option-wide mt-12">
                <input type="checkbox" id="settingHoverOnDemand" />
                <div>
                  <div class="fw-600">Generate hover previews on demand</div>
                  <div class="hint-sm">
                    When enabled, hovering a card will request the server to create a preview if one doesn’t exist yet. This may start background work and use CPU.
                  </div>
                </div>
              </label>
            </div>
          </div>
          <div class="task-section task-section-spaced">
            <div class="section-header">
              <h2>Job Processing</h2>
            </div>
            <div class="file-selection file-selection-compact file-selection-inline">
              <div class="flex-row gap-16 w-100">
                <div class="fw-600">Max concurrent jobs</div>
                <input type="number" id="settingConcurrency" min="1" max="16" step="1" value="4" class="w-120" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</body>
</html>